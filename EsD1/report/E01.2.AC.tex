\documentclass[10pt, a4paper, italian]{article}
\input{../../latex/preamble}
\input{../../latex/math}
\usepackage{multicol}
\usepackage{diagbox}
\geometry{left=2cm, right=2cm, top=2cm, bottom=2cm}

% indexes subsections with letters, sections with numbers (1.a, 1.b, ...)
\renewcommand{\thesubsection}{\thesection.\alph{subsection}}

% lets graphicx know path where figures to be included are found
\graphicspath{{../figs/}}

\author{Gruppo 1.AC \\ Matteo Rossi, Bernardo Tomelleri}
\title{EsD1: Caratterizzazione di porte logiche e semplici circuiti logici.}
\begin{document}
\date{\today}
\maketitle

\setcounter{section}{0}

\section{Misura componenti dei circuiti}
\begin{table}[htbp]
\centering
\begin{tabular}{ccc}
\toprule
Resistenze $[\si{\ohm}]$ & $R$ & $\sigma R$ \\
\midrule
\midrule
$R\ped{pot}$	& 9.53 k	& 0.08 k 		\\
$R_0$	  		& 993		& 8				\\
$R_1$	  		& 992		& 8	 			\\
$R_2$	  		& 993		& 8	 			\\
$R_3$	  		& 994		& 8	 			\\
$R_4$	  		& 997		& 8	 			\\
\bottomrule     
\end{tabular}
\caption{Valori di resistenza misurati per i componenti passivi dei circuiti
studiati. \label{tab: rmesB}}
\end{table}

\begin{table}[htbp]
\centering
\begin{tabular}{ccc}
\toprule
Resistenze $[\si{\ohm}]$ & $R$ & $\sigma R$ \\
\midrule
\midrule
$R\ped{pot}$	& 9.53 k	& 0.08 k 		\\
$R_0$	  		& 993		& 8				\\
$R_1$	  		& 992		& 8	 			\\
$R_2$	  		& 993		& 8	 			\\
$R_3$	  		& 994		& 8	 			\\
$R_4$	  		& 997		& 8	 			\\
\bottomrule     
\end{tabular}
\caption{Valori di resistenza misurati per i componenti passivi dei circuiti
studiati. \label{tab: rmesM}}
\end{table}

Riportiamo per completezza anche il valore della tensione continua di
alimentazione per i circuiti integrati misurata con il multimetro
\begin{align*}
V_{CC} &= 4.99 \pm 0.03 \si{\V} \\
\end{align*}

\subsection*{Nota sul metodo di fit}
Per determinare i parametri ottimali e le rispettive covarianze si \`e
implementato in \verb+Python+ un algoritmo di fit basato sui minimi quadrati
mediante la funzione \emph{curve\_fit} della libreria \texttt{SciPy}.

%=======================
\section{Caratteristiche fisiche delle porte logiche}
Si studia il comportamento delle porte NOT TTL contenute nel circuito integrato
SN7404 misurando le tensioni e correnti di operazione e verificando che queste
rientrino nelle specifiche tecniche riportate nel Data-Sheet del chip.

\subsection{Tensioni di operazione}
Come prime misure verifichiamo i valori delle tensioni di soglia in ingresso e tipiche in uscita, da cui è possibile ricavare il Noise Margin.\\
%la definizione di noise margin prevede di usare i valori minimi e massimi ma nella scheda chiede di trovare le tensioni tipiche: infatti anche sul datasheet sono riportate sia quelle min e max che quelle typ per i valori in output.. magari vediamo che valori ci escono
Generiamo una rampa di tensione 0-5 V e visualizziamo i segnali prodotti:
in questo modo è possibile costruire un grafico di $V\ped{out}$ in funzione di $V\ped{in}$.\\ %possiamo usare sia dalla modalità XY che prendendo i dati, magari possiamo fare entrambe le cose e vedere qual è meglio..

Dove $V\ped{OH, min}$ è il minimo valore interpretato in output dalla porta come alto; analogamente possiamo descrivere le altre grandezze presenti nelle definizioni.\\
Dalle specifiche del DS si ha che i valori attesi sono
\begin{table}[htb]
\centering
\begin{tabular}{cccc|c}
\toprule
Parameter  & min & typ & max & [Unit] \\
\midrule
\midrule
$V_{CC}$ &  &  & $7$ & V \\
$V_I$	 &  &  & $5.5$ & V\\
$V_{OH}$ & $2.4$  & $3.4$ & & V \\
$V_{OL}$ & $0.2$  & $0.4$ & & V \\
$V_{IH}$ & $2$  &  & & V  \\
$V_{IL}$ &  &  & $0.8$ & V \\
$I_{IH}$ &  &  & $40$ & $\si{\micro\A}$ \\
$I_{OH}$ &  &  & $-0.4$ & mA \\
\bottomrule 
\end{tabular}

\caption{Valori delle tensioni e correnti di operazione indicati sul
datasheet dell'integrato SN7404.}
\label{tab: notDS}
\end{table}
Possiamo quindi ricavare i valori attesi del Noise Margin High e Low
definiti rispettivamente come
\begin{align*}
    NM_H = V\ped{OH, min} - V\ped{IH, min} = 2.4 - 2 = 0.4 \; \si{\V} \\
    NM_L = V\ped{IL, max} - V\ped{OL, max} = 0.8 - 0.4 = 0.4 \; \si{\V}
\end{align*}

come misure delle tensioni di operazione otteniamo
%TODO spiegare come abbiamo misurato
\begin{align*}
V_{OH} = \pm \; \si{\V} \\
V_{OL}= \pm \; \si{\V} \\
V_{IH} = \pm \; \si{\V} \\
V_{IL} = \pm \; \si{\V} \\
\end{align*}
%TODO vedere se torna

Da cui troviamo le nostre stime dei valori delle soglie di rumore per le porte
NOT studiate
\begin{align*}
NM_H = \pm \; \si{\V} \\
NM_L = \pm \; \si{\V}
\end{align*}

\subsection{Misura del Fan-out}
Il Fan-Out è il numero massimo di porte che una singola porta può guidare
restando entro le specifiche di funzionamento ed è definito nel seguente modo
\[
\text{FO} = \frac{I\ped{OH, max}}{I\ped{IH, max}}
\]
Dalle specifiche del DS risulta quindi che 
\begin{align*}
    I\ped{IH, max}= -0.4 \; \si{m\A} \\
    I\ped{OH, max}= 40 \; \si{\micro\A} \\
    \text{FO} = 10
\end{align*}

Misuriamo le correnti\\ 
%TODO descrivere un minimo il procedimento
\section{Circuiti logici elementari con sole porte NAND}
Una fondamentale caratteristica delle porte NAND è la loro universalità, ossia il fatto che è possibile realizzare qualsiasi tipo di circuito: infatti, con combinazioni di porte NAND, possiamo ottenere circuiti equivalenti dalle porte AND, OR e NOT, a partire dalle quali è possibile realizzare qualsiasi circuito.

\begin{figure}
    %\includegraphics[width=\textwidth]{NAND}
    \label{fig: NAND}
\end{figure}

\subsection{Tabella di verità}
Dalla funzione StaticIO visualizziamo la tabella di verità e la verifichiamo utilizzando gli interruttori.\\
\\
(Utilizzando le funzioni Pattern di Waveform producete le quattro possibili coppie di valori in ingresso e con la funzione Logic acquisite questi due segnali assieme al segnale in uscita e riportate il grafico nella relazione)\\
\\
Producendo, tramite la funzione Pattern, le quattro coppie degli ingressi, riportiamo le acquisizioni dei segnali visualizzati con Logic.\\
\\
Riportiamo inoltre il grafico

\subsection{Circuiti con porte NAND}
In questa sezione vogliamo analizzare dei circuiti con il solo utilizzo di porte NAND.\\
\\
(Riportare per ognuno:\\
la derivazione analitica, utilizzando l'algebra di Boole, che trasformi la funzione logica desiderata in soli NAND;\\
lo schema del circuito;\\
un'acquisizione effettuata utilizzando le funzioni Pattern e Logic che dimostri la funzionalità del circuito.)

\subsubsection*{Porta OR}
Come primo circuito vogliamo realizzare una porta OR: detti \textit{A} e \textit{B} gli ingressi e \textit{Y} l'uscita, nella notazione dell'algebra booleana si ha
\[
    Y = A + B
\]
Sfruttando la legge di De Morgan si ottiene
\[
    Y = A + B = \overline{\overline{A}\cdot\overline{B}}
\]
che descrive la relazione OR in termini del NAND.\\
Nota la relazione per ottenere un NOT utilizzando porte NAND, riportiamo lo schema del circuito
\begin{figure}[htbp]
    \centering
    %\includegraphics[width=0.45\textwidth]{OR}
    \label{fig: OR}
\end{figure}


\subsubsection*{Circuito selettore a due vie (multiplexer)}
Realizziamo un circuito che permetta di assegnare all'uscita il valore di uno dei due ingressi a singolo bit tramite il valore di un terzo ingresso.
Indichiamo con \textit{A}, \textit{B} e \textit{C} gli ingressi e con \textit{Y} l'uscita; 
    \[
    \begin{cases}
    C=0 \implies Y=A\\
    C=1 \implies Y=B
    \end{cases}
    \]
il funzionamento del nostro circuito può essere descritto dalla tabella di Karnaugh riportata sotto\\
\begin{table}
    \centering
    \begin{tabular}{c||c|c|c|c}
        \backslashbox{C}{AB} & 00 & 01 & 11 & 10\\
        \hline
        \hline
        0 & 0 & 0 & 1 & 1\\
        \hline
        1 & 0 & 1 & 1 & 0\\
    \end{tabular}
\end{table}

da cui si ricava facilmente la seguente relazione per il circuito
\[
Y=A\cdot\overline{C}+B\cdot C
\]
e, sempre sfruttando De Morgan, si ha
\[
Y=A\cdot\overline{C}+B\cdot C=\overline{(\overline{A\cdot\overline{C}})\cdot(\overline{B\cdot C})}
\]
Riportiamo sotto lo schema del circuito
\begin{figure}[htbp]
    \centering
    %\includegraphics[width=0.6\textwidth]{cir2}
    \label{circuito2}
\end{figure}

Per dimostrare il corretto funzionamento del circuito riportiamo le acquisizioni di Pattern, in cui è possibile comprendere come sono stati impostati gli ingressi, e Logic, da cui si può verificare il corretto funzionamento del circuito.
\begin{figure}[htbp]
    \centering
    %\includegraphics[width=0.8\textwidth]{pat2}
    \caption{Pattern: DIO 0 $\equiv$ C, DIO 1 $\equiv$ A e DIO 2 $\equiv$ B}
    \label{pat2}
\end{figure}

\begin{figure}[htbp]
    \centering
    %\includegraphics[width=0.8\textwidth]{log2}
    \caption{Logic: DIO 0 $\equiv$ C, DIO 1 $\equiv$ A, DIO 2 $\equiv$ B e DIO 3 $\equiv$ Y}
\end{figure}


\section{Circuiti logici complessi a più chip}
\subsection{Convertitore Gray-Binario}
    Come ultima cosa vogliamo realizzare un circuito in grado di convertire un valore a 4 bit dalla codifica Gray in Binario utilizzando un solo integrato di tipo SN74LS86 a porte XOR.
    Un convertitore Gray-Binario può essere schematizzato come in \cref{fig: gb}: il nostro obiettivo è quello di verificare che tale circuito si comporti come atteso.
\begin{figure}[htbp]
    %\includegraphics[width=0.8\textwidth]{gb}
    \caption{Schema convertitore Gray-Binario\label{fig: gb}}
\end{figure}

\begin{table}[htbp]
    \centering
    \begin{tabular}{c||c}
        Codice binario & Codice Gray \\
        \hline
        \hline
        0000 & 0000\\
        0001 & 0001\\
        0010 & 0011\\
        0011 & 0010\\
        0100 & 0110\\
        0101 & 0111\\
        0110 & 0101\\
        0111 & 0100\\
        1000 & 1100\\
        1001 & 1101\\
        1010 & 1111\\
        1011 & 1110\\
        1100 & 1010\\
        1101 & 1011\\
        1110 & 1001\\
        1111 & 1000\\
        \end{tabular}
    \caption{Conteggio a 4 bit nei due codici.}
    \label{tab: grbin}
\end{table}

Il codice Gray differisce dal codice binario in quanto si passa da un intero al successivo modificando un solo bit per volta.\\
Calcoliamo l'uscita del circuito per alcuni valori in ingresso:
\begin{table}[htbp]
    \centering
    \[
    \begin{array}{cccc|cccc}
        G_3 & G_2 & G_1 & G_0 & B_3 & B_2 & B_1 & B_0\\
        \hline
        0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
        1 & 1 & 1 & 1 & 1 & 0 & 1 & 0\\
        1 & 0 & 0 & 1 & 1 & 1 & 1 & 0\\
        1 & 0 & 0 & 0 & 1 & 1 & 1 & 1\\
    \end{array}
    \]
\end{table}

Confrontando le uscite ottenute con i valori riportati in \cref{tab: grbin} affermiamo che il circuito si comporta correttamente come convertitore Gray-Binario. Come conferma, riportiamo un'acquisizione.\\
\begin{figure}[htbp]
    \centering
    \includegraphics[width=\textwidth]{graybin}
    \caption{Acquisizione di un ciclo completo (frequenza 1 kHz) con Logic
    Analyzer dei segnali in ingresso e in uscita dal convertitore Gray-binario.}
\end{figure}
\begin{figure}[htbp]
    \centering
    \includegraphics[width=\textwidth]{gray20ns}
    \caption{Acquisizione del Logic Analyzer durante la transizione dal numero $15$ al numero $0$ su scala dei tempi pari a $20$ ns.}
\end{figure}
Per una scala dei tempi molto stretta, si registra che i tempi di propagazione non sono istantanei, distinguendo dei glitch sui canali di uscita. \\ 

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\textwidth]{gray10ns}
    \caption{Transizione dal $15$ allo $0$ su scala temporale pari a $10$ ns.}
\end{figure}
(verificate il funzionamento del circuito utilizzando Pattern per generare un contatore a 4 bit con la codifica opportuna e osservando l’uscita con Logic (come ai punti precedenti);\\
%TODO motivare l’osservazione del punto precedente tenendo conto del tempo di propagazione necessario per i due circuiti;\\

%TODO riportare tutti i grafici necessari a dimostrare il funzionamento del circuito

\subsection{Sommatore a 2 bit}
Vogliamo costruire un sommatore a due bit utilizzando i chip
\texttt{SN74LS08} (quad-AND), \texttt{SN74LS32} (quad-OR), 
\texttt{SN74LS86} (quad-XOR). Il circuito costruito è riportato in
\cref{fig: fulladder}.

\begin{figure}[htbp]
    \centering
%    \includegraphics[width=0.6\linewidth]{fulladder}
    \caption{Schema circuitale di un sommatore a due bit.}
    \label{fig: fulladder}
\end{figure}

Verifichiamo il funzionamento mandando in ingresso tutte le possibili combinazioni di due numeri a due bit. Per fare ciò mandiamo ai 4 ingressi del circuito un segnale che conta in binario. Il risultato è mostrato in \cref{fig: faAD2}.

\begin{figure}[htbp]
    \centering
%    \includegraphics[width=\linewidth]{fulladderAD2}
    \caption{Andamento del sommatore, si consulti la colonna di sinistra per il significato di ciascuna riga.}
    \label{fig: faAD2}
\end{figure}

Aggiungiamo al circuito 4 led verdi e un led rosso: questi sono pilotati da 5 nuovi cavi dell'AD2. Per controllare il loro funzionamento aggiungiamo a Patterns una tabella delle verità, riportata in \cref{fig: Ver}, che faccia in modo che ad ogni step si illuminino un numero di led pari al valore della somma. Il led rosso verrà usato per controllare l'overflow, ovvero la possibilità che il risultato sia maggiore o uguale a 5.

\begin{figure}[htbp]
    \centering
%    \includegraphics[width=0.8\linewidth]{ROM}
    \caption{Tabella delle verità usata.}
    \label{fig: Ver}
\end{figure}


%=======================
\section*{Conclusioni e commenti finali}
Si è riusciti a verificare il corretto comportamento delle porte TTL studiate
caratterizzandone le tensioni, correnti di operazione e tempi caratteristici
di circuiti integrati come il SN7404.
Inoltre, è stato possibile verificare il funzionamento di circuiti logici di
diversa complessità costruiti con porte NAND, XOR, e OR e si è riusciti ad
apprezzare l'effetto dei tempi di propagazione delle porte nella conversione
dalla codifica Gray al binario.

%=======================
\section*{Dichiarazione}
I firmatari di questa relazione dichiarano che il contenuto della relazione \`e
originale, con misure effettuate dai membri del gruppo, e che tutti i firmatari
hanno contribuito alla elaborazione della relazione stessa.

\end{document}
