\documentclass[10pt,a4paper]{article}
\input{../../latex/preamble}
\input{../../latex/math}
\geometry{left=2cm, right=2cm, top=2cm, bottom=2cm}

% indexes subsections with letters, sections with numbers (1.a, 1.b, ...)
\renewcommand{\thesubsection}{\thesection.\alph{subsection}}

% lets graphicx know path where figures to be included are found
\graphicspath{{../figs/}}

\author{Gruppo 1.AC \\ Matteo Rossi, Bernardo Tomelleri}
\title{Es05A: Applicazioni non-lineari di amplificatori operazionali}
\begin{document}
\date{\today}
\maketitle

\setcounter{section}{0}

\section*{Misura componenti dei circuiti}
\begin{table}[htbp]
\centering
\begin{tabular}{cccccc}
\toprule
Resistenze $[\si{k\ohm}]$ & $R$ & $\sigma R$ & Capacità $[\si{n\F}]$ & $C$ &
$\sigma C$ \\
\midrule
\midrule
$R_1^Q$	  & 100.6 	& 0.8 	 & $C_T$ & 1.00		 & 0.04 \\
$R_1^T$	  & 9.94	& 0.08 	 & $C_F$ & 1.00		 & 0.04 \\
$R_2^T$	  & 2.19	& 0.03	 & $C_1$ & 96		 & 4	\\
$R_2^a$	  & 9.94	& 0.08	 & $C_2$ & 1.00		 & 0.04 \\
$R_3$	  & 9.92	& 0.08	 & & & \\
$R_4$	  & 9.94	& 0.08	 & & & \\
\bottomrule     
\end{tabular}
\caption{Valori di resistenza e capacità misurate per i componenti dei
circuiti studiati. \label{tab: rcmes_B}}

\begin{tabular}{cccccc}
\toprule
Resistenze $[\si{\ohm}]$ & $R$ & $\sigma R$ & Capacità $[\si{n\F}]$ & $C$ &
$\sigma C$ \\
\midrule
\midrule
$R_1^Q$	  & 99.8 	& 0.8 	 & $C_T$ & 1.00		 & 0.04 \\
$R_1^T$	  & 9.94	& 0.08 	 & $C_F$ & 1.00		 & 0.04 \\
$R_2^T$	  & 2.19	& 0.03	 & $C_1$ & 99		 & 4	\\
$R_2^A$	  & 9.87		& 0.08		 & $C_2$ & 1.00		 & 0.04 \\
$R_3^A$	  & 10.01		& 0.08		 & & & \\
$R_4^M$	  & 9.91		& 0.08		 & & & \\
\bottomrule     
\end{tabular}
\caption{Valori di resistenza e capacità misurate per i componenti dei
circuiti studiati. \label{tab: rcmes_M}}
\end{table}

Riportiamo per completezza anche i valori delle tensioni di alimentazione
continue per l'op-amp misurate con il multimetro
\begin{align*}
V_{CC} &= 4.99 \pm 0.03 \si{\V} \\
V_{EE} &= -4.99 \pm 0.03 \si{\V}
\end{align*}

Non è stato facile misurare i valori di capacità dei condensatori nel
circuito con il multimetro, che a volte con i soli puntali collegati legge
un rumore di fondo intorno ai $7 \pm 1 \; \si{n\F}$, abbastanza alto da
saturare il fondo scala da $\SI{2}{n\F}$ con cui si vorrebbero misurare i
valori delle capacità $C_T$, $C_F$ e $C_2$.

Per tutto il resto della trattazione come ampiezze dei segnali si intendono
misurate non ``picco - picco'', a meno che non venga esplicitato altrimenti.

\subsection*{Nota sul metodo di fit}
Per determinare i parametri ottimali e le rispettive covarianze si \`e
implementato in \verb+Python+ un algoritmo di fit basato sui minimi quadrati
mediante la funzione \emph{curve\_fit} della libreria \texttt{SciPy}.

%=======================
\section{Circuito amplificatore di carica}
\subsection{Progettazione del circuito}
Si è costruito un amplificatore di carica a partire da un op-amp TL081CP come
quello in figura \ref{fig: Qampschm}

\begin{figure}[htbp]
    \centering
	\includegraphics[scale=1.2]{Qamp}
    \caption{Schema circuitale dell'amplificatore di carica costruito.
    \label{fig: Qampschm}}
\end{figure}

In cui abbiamo indicato i sotto-circuiti di cui è composto, da sinistra verso
destra come: ``iniettore/rivelatore di carica'', ``circuito formatore/shaper''
(passa-basso/integratore attivo) e ``discriminatore/comparatore''.

\subsection{Funzionamento di iniettore e shaper}
Si è inviato all'ingresso di entrambi i circuiti un'onda quadra di
ampiezza $V_s = 999 \pm 8 \si{m\V}$ e frequenza fissata a
$f = 100.0 \pm 1.6 \; \si{\Hz}$, che corrisponde ad una carica
$Q\ped{in} = C_T \cdot 2V_s = 1.98 \pm 0.08 \; \si{n\coulomb}$, proporzionale
al ``salto'' di tensione dal livello alto a basso (e viceversa) dell'onda,
più semplicemente alla sua ampiezza picco-picco
$V_s^{pp} = 2 V_s \implies Q\ped{in} = C_T \cdot V_s^{pp}$.

Dunque abbiamo trovato come segnale in uscita dal circuito formatore un
segnale che dopo un breve transiente diventa un esponenziale decrescente,
con ampiezza iniziale $V\ped{sh} (t=0) = 2007 \pm 18 \; \si{m\V}$ e
con la stessa frequenza $99.9 \pm 1.6 \; \si{\Hz}$ dell'onda quadra.
Riportiamo in figura l'immagine acquisita dall'oscilloscopio con dettaglio
sul transiente al fronte di discesa dell'onda quadra.
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.335]{shaperzoom}
    \caption{Acquisizione del segnale in uscita dal circuito formatore con
    un'onda quadra in ingresso $V_s = \SI{1}{V}$, $f= \SI{100}{\Hz}$
    \label{fig: shzoom}}
\end{figure}

Assumendo iniezione di carica istantanea sulle armature dei condensatori $C_T$
e $C_F$, il segnale in uscita dal sotto-circuito formato da $C_T$ e dal
formatore è legato al segnale in ingresso dalla relazione
\begin{align}\label{eq:Vsh}
V\ped{sh}(t) &= \frac{Q\ped{in}}{C_F} e^{-t/\tau} =
2V_s(t) \frac{C_T}{C_F} e^{-t/\tau} \\
\tau &= R_1 C_F
\end{align}
Per i circuiti in esame i valori delle capacità sono
$C_T \approx C_F = \SI{1}{n\F}$ e $R_1 = \SI{100}{\kilo\ohm}$,
per cui possiamo semplificare il rapporto $C_T/C_F \approx 1$, da cui
ricaviamo come valori attesi
\begin{align*}
V\ped{sh}(t) &= 2V_s(t) e^{-t/\tau} \\
\tau &= R_1 C_F = 100 \pm 4 \; \si{\micro\s}
\end{align*}
Quindi complessivamente come tensione in uscita $V\ped{sh} (t)$ ci aspettiamo
di osservare una serie di picchi seguiti da decrescite esponenziali di segno
alternante con l'onda quadra in ingresso e di ampiezza doppia.

Questo risulta compatibile con quanto si è osservato dall'oscilloscopio, che
riportiamo per chiarezza in figura~\ref{fig: shaper}
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.335]{shaper}
    \caption{Onda quadra in ingresso $V_s = \SI{1}{V}$, $f = \SI{100}{\Hz}$
    su CH1 e segnale in uscita dal circuito formatore $V\ped{sh}$ su CH2.
    \label{fig: shaper}}
\end{figure}

Dunque possiamo controllare che la forma d'onda esponenziale sia compatibile
con quanto atteso dalla \eqref{eq:Vsh} tramite un fit ai punti campionati
dall'AD2, di cui riportiamo brevemente i risultati
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.6]{tau}
    \caption{Fit con esponenziale decrescente al segnale in uscita dal
    circuito formatore $V\ped{sh}$ \label{fig: tau}}
\end{figure}
\begin{align*}
V\ped{sh} (t=0) &= 2021 \pm 2 \; \si{m\V}
&\tau = 101.88 \pm 0.03 \; \si{\micro\s} \\
\chi^2/\mathrm{ndof} &= 2774/4086 &\mathrm{cov_{norm}} = -0.75
\end{align*}

Da cui vediamo come non solo la misura di ampiezza iniziale sia compatibile
con il valore misurato, ma anche il tempo caratteristico di smorzamento $\tau$
risulta pienamente in accordo con il valore atteso dai componenti del
circuito.

\setcounter{subsection}{3}
\subsection{Funzionamento del discriminatore}
Il sotto-circuito discriminatore è un comparatore con tensione di soglia
$V\ped{thr} = 60 \pm 0.4 \si{m\V}$ fornita dal generatore di tensione
\verb+W2+ collegato all'ingresso invertente del secondo OpAmp.

Supponiamo di essere sempre in regime di saturazione per l'OpAmp ideale e
come prima assumiamo iniezione istantanea di carica sui condensatori. 
Grazie al fatto che le tensioni di alimentazione sono pari in modulo
$V_{CC} = - V_{EE}$ possiamo prendere come segnale atteso in uscita
\begin{equation}\label{eq: Vdiscr}
V\ped{discr} (t) = V_{CC} \sgn\left[V\ped{sh}(t) - V\ped{thr}\right].
\end{equation}

Più esplicitamente, ricordando che $V\ped{sh}$ ha ampiezza (iniziale) doppia
rispetto all'ampiezza in ingresso $V_s$ (o proporzionale a $V_s^{pp}$)
\begin{itemize}
\item se $V_s^{pp} < V\ped{thr} \implies V\ped{discr} = V_{EE}$ costante.
\item se $V_s^{pp} \geq V\ped{thr}$, ci aspettiamo (in un periodo dell'onda
quadra di durata $T = 9.99 \pm 0.16 \; \si{m\s}$)
\[
V\ped{discr}(t) =
\begin{cases}
V_{CC} & 0 < t < ToT \\
V_{EE} & ToT < t < T
\end{cases}
\]
In cui $ToT$ è il tempo in cui il picco esponenzialmente decrescente è
maggiore della tensione di soglia
$V\ped{sh}(t) = \frac{Q\ped{in}}{C_F} e^{-t/\tau} \geq V\ped{thr}$, appunto il
``Time-over-Threshold''.
\begin{equation} \label{eq:ToT}
ToT = \tau \log\left(\frac{Q\ped{in}}{C_F V\ped{thr}}\right) =
\tau \log\left(\frac{C_T V_s^{pp}}{C_F V\ped{thr}}\right) = 
\tau \log\left(\frac{C_T}{C_F} \frac{2 V_s}{V\ped{thr}}\right).
  \end{equation}
\end{itemize}

Mantenendo lo stesso segnale in ingresso al circuito del punto precedente
(con ampiezza ben oltre la soglia $V_s \gg V\ped{thr}$) riportiamo il
segnale visualizzato all'oscilloscopio in uscita dal discriminatore in figura
\ref{fig: discr}
\begin{figure}[htbp]
\centering
\includegraphics[scale=0.335]{discrzoom}
\caption{Acquisizione del segnale in uscita dal circuito comparatore con
un'onda quadra in ingresso $V_s = \SI{1}{V}$, $f = \SI{100}{\Hz}$
\label{fig: discr}}
\end{figure}
Risulta già chiaro dal dettaglio a destra, in corrispondenza del fronte di
discesa dell'onda quadra, come il segnale in uscita non ha né livelli basso
e alto simmetrici rispetto a $\SI{0}{V}$, né pendenza uguale (idealmente
infinita) nel passaggio tra questi due, al contrario di quanto atteso dal
nostro modello semplificato.

Possiamo caratterizzare il segnale $V\ped{discr}$ trovato come un impulso di
tensione con livello basso $V_{OL}$ e livello alto $V_{OH}$ di durata
$T_{OH}$ che si ripete periodicamente con la stessa frequenza dell'onda quadra
in ingresso $V_s (t)$. Riportiamo le misure dirette effettuate con i cursori
delle tensioni di saturazione del comparatore e una misura del tempo ``alto''
dell'impulso definita in maniera compatibile con la funzione automatica di
misura ``PosWidth'' (cioè come il tempo in cui la tensione si trova al di
sopra della metà del valore positivo dell'impulso, che quindi sovrastima
per la pendenza decisamente non ideale dei fronti d'onda).
\begin{align*}
V_{OH} &= 4.38 \pm 0.03 \; \si{\V} \\
V_{OL} &= -3.53 \pm 0.02 \; \si{\V} \\
T_{OH} &= 416 \pm 5 \; \si{\micro\s}
\end{align*}

Osserviamo quindi che i valori di saturazione alta e bassa misurati non sono
compatibili con quelli attesi, ma sono entrambi inferiori (in modulo). Questo
può essere dovuto al fatto che in realtà il TL081 in regime di saturazione
produce al massimo tensioni entro il suo (Maximum Output) \emph{Voltage swing}
riportato come valore tipico nel datasheet $V\ped{OM, typ} = 13.5$,
sensibilmente inferiore rispetto al valore di tensione di alimentazione tipico
a cui è riferito $V\ped{CC, typ} = \SI{15}{\V}$.

Quindi, volendo ragionare per analogia ci aspettiamo un escursione massima tra
le tensioni di saturazione (date le nostre tensioni di alimentazione a
$\pm \SI{5}{\V}$) $V_{OM} = 13.5 \cdot \frac{V_{CC}}{V\ped{CC, typ}} =
13.5 /3 = 4.5 \; \si{\V}$, che risulta sicuramente più vicino a quanto
abbiamo misurato.

\subsection{Durata impulso per carica di test}
Abbiamo scelto come ampiezza per l'onda quadra $V_s = 999 \pm 8 \si{m\V}$ e
frequenza $f = 100.0 \pm 1.6 \; \si{k\Hz}$, dunque come carica
iniettata $Q\ped{in} = C_T \cdot 2 V_s = 1.98 \pm 0.08 \; \si{n\coulomb}$.
Si è scelta una frequenza abbastanza bassa, con periodo corrispondente a
$1/f = T \gg \tau$ di modo che tra una iniezione di carica e l'altra (cioè tra
ogni semiperiodo dell'onda quadra $V_s (t)$) i condensatori abbiano tempo di
scaricarsi, così da poter considerare indipendente ogni iniezione di carica
dalla precedente.

L'impulso in uscita ha durata pari a $415 \pm 5 \; \si{\micro\s}$ in un circuito e $410 \pm 5 \; \si{\micro\s}$ nel secondo.

Per quanto riguarda il valore atteso per la durata dell'impulso, possiamo
confrontare i due valori trovati per il tempo ``alto'' con il valore atteso
di Time-over-Threshold
\[
ToT = R_1 C_F \log\left(\frac{C_T}{C_F} \frac{2 V_s}{V\ped{thr}}\right) =
350 \pm 14 \; \si{\micro\s}
\]

%Questo è in ottimo accordo con quanto trovato sperimentalmente dalla nostra
%analisi.

\subsection{Andamento di TOT al variare di $Q\ped{in}$}
\begin{figure}[htbp]
\centering
\includegraphics[scale=0.335]{shaper_discrzoom}
\caption{Acquisizione del segnale in uscita dal circuito discriminatore con
un'onda quadra in ingresso $V_s = \SI{1}{\V}$, $f = \SI{100}{\Hz}$
\label{fig: shaperdiscr}}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.335]{discr_sat}
\caption{Acquisizione del segnale in uscita dal circuito discriminatore con
un'onda quadra in ingresso $V_s = \SI{30}{m\V}$, $f = \SI{100}{\Hz}$
\label{fig: discr_sat}}
\end{figure}
Il fronte di salita all'uscita del discriminatore è sicuramente limitato dallo
slew rate finito dell'amplificatore
\[
t_{oh} = V\ped{disc}^{pp}/SR = 7.9 / 13 = 2 \; \si{\micro\s}
\]
mentre il fronte di discesa è meno ripido perché corrisponde alla transizione
del discriminatore sulla discesa esponenziale di $V\ped{sh}$, che ha una derivata
piccola in prossimità della soglia. Questo infatti lascia presumere che esista
un intervallo temporale durante il quale l'uscita di $V\ped{discr}$ è in zona
lineare.

Infatti si è trovato, per ampiezza dell'onda quadra prossima alla soglia
\begin{figure}[htbp]
\centering
\includegraphics[scale=0.335]{shdiscthr}
\caption{Acquisizione del segnale in uscita dal circuito discriminatore con
un'onda quadra in ingresso $V_s = \SI{20}{m\V}$, $f = \SI{100}{\Hz}$
\label{fig: discrthr}}
\end{figure}
che è proprio il transiente dello shaper visto in \ref{fig: shzoom} amplificato
dal secondo OpAmp in regime lineare.

\subsection{Minima carica per cui satura il comparatore}
Provando con varie ampiezza in ingresso, in entrambi i circuiti si sono verificati i medesimi risultati: per ampiezze dei segnali in ingresso maggiori dei 50 mV non sono presenti particolari deformazioni nel segnale in uscita; al di sotto dei 50 mV invece il segnale in uscita inizia a deformarsi, assumendo la forma di una parabola rovesciata che si sposta verso il basso più diminuiamo l'ampiezza in ingresso; questo comportamento si osserva fino a circa 30 mV, quando il segnale in uscita diventa impercettibile e scompare.

\subsection{Confronto con i valori attesi}
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.6]{logfit}
    \caption{Fit logaritmico del $ToT$ in funzione dell'ampiezza di carica in
    ingresso $Q\ped{in}$ \label{fig: logfit}}
\end{figure}
\begin{align*}
V\ped{thr} &= 40.7 \pm 0.2 \; \si{m\V}
&\tau = 106.51 \pm 0.3 \; \si{\micro\s} \\
\chi^2/\mathrm{ndof} &= 0.6/8 &\mathrm{cov_{norm}} = 0.82
\end{align*}

Ritroviamo che il valore del tempo di smorzamento $\tau$ è compatibile con il
valore atteso dai componenti del circuito.
%=======================
\section{Trigger di Schmitt}

\begin{figure}[htbp]
    \centering
	\includegraphics[scale=1.5]{trgSchmitt}
    \caption{Schema circuitale del trigger di Schmitt costruito.
    \label{fig: trgschmittschm}}
\end{figure}

\subsection{Risposta ad un'onda sinusoidale}

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.335]{schmitt}
\caption{risposta ad un segnale sinusoidale di ampiezza 1 V e frequenza 100 Hz del trigger di schmitt}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.4]{shmitt_isteresi}
\caption{risposta ad un segnale sinusoidale di ampiezza 2 V e frequenza 100 Hz del trigger di schmitt, visto nel piano XY in cui il segnale in ingresso è sulle x e il segnale in uscita sulle y}
\end{figure}


\subsection{Saturazione dell'OpAmp}

\[
V_{S+} = 4.21 \pm 0.04 \; \si{\V}
\]
\[
V_{S-} = -3.53 \pm 0.03 \; \si{\V}
\]
\subsection{Tensioni di soglia e funzionamento del trigger}
Abbiamo inviato in ingresso all'amplificatore un'onda sinusoidale di ampiezza
$1999 \pm 15 \; \si{m\V}$ e frequenza $1000 \pm 16 \; \si{\Hz}$.
Dalle intersezioni tra i due canali abbiamo misurato le transizioni basso-alto
(OH) e alto-basso (OL)

\[
V_{OH} = 617 \pm 5 \; \si{m\V}
\]
\[
V_{OL} = 782 \pm 6 \; \si{m\V}
\]
Per il secondo circuito invece è stata fatta una media pesata sui punti sulle 2 linee verticali che si formano nel grafico XY (ovviamente una per ogni linea).
\[
V_{OH} = 611.6 \pm 0.5 \; \si{m\V}
\]
\[
V_{OL} = 780.4 \pm 0.5 \; \si{m\V}
\]
\subsection{Limiti fisici del circuito}
\[
F_{L} = 92.6 \pm 0.1 \; \si{k\Hz}
\]
\[
SR = 11.1 \pm 0.3 \; \si{k\Hz}
\]
\begin{figure}[htbp]
\centering
\includegraphics[scale=0.4]{schmitt_freq}
\caption{analisi in frequenza del trigger di schmitt, in particolare l'unico punto di interesse si trova a circa 90 kHz, punto in cui smette di funzionare}
\end{figure}
%=======================
\section{Multivibratore astabile}

\begin{figure}[htbp]
    \centering
	\includegraphics[scale=1.5]{astable}
    \caption{Schema circuitale del multivibratore astabile costruito.
    \label{fig: astableschm}}
\end{figure}

\subsection{Funzionamento del circuito}
\[
\beta= \frac{R_1}{R_1 + R_2}
\]
\[
T = 2 R_3 C_1 \ln(\frac{1+\beta}{1-\beta})
\]


\setcounter{subsection}{2}
\subsection{Studio dei segnali in ingresso e uscita}
Si è inviato all'ingresso del filtro passa-alto un segnale triangolare di
ampiezza $v\ped{in} = 200 \pm 2 \si{m\V}$ e frequenza
$f = 100.0 \pm 1.6 \si{\Hz}$.

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.4]{V+Vout}
\caption{Grafico segnale in $V_+$ e segnale in $V_{out}$}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.4]{V-Vout}
\caption{Grafico segnale in $V_-$ e segnale in $V_{out}$}
\end{figure}


\subsection{Misure di periodo e duty cycle}

\[
DC = 0.482 \pm 0.013
\]
\[
T = 2.15 \pm 0.02 \si{m\s}
\]
\[
T_{atteso} = 2.17 \pm  D A   C A L C O L A R E \si{m\s}
\]

\subsection{Limite massimo in frequenza del generatore}

%=======================
\section{Multivibratore monostabile}
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=1.2]{monostable}
    \caption{Schema circuitale del multivibratore monostabile costruito.
    \label{fig: monostableschm}}
\end{figure}

\subsection{Studio dei segnali in ingresso e uscita}

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.42]{monostabile}
\caption{Grafico segnale in ingresso e $V_{out}$}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.42]{monostabileV+}
\caption{Grafico segnale in $V_{+}$ e $V_{out}$}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.42]{monostabileV-}
\caption{Grafico segnale in $V_{-}$ e $V_{out}$}
\end{figure}

\subsection{Durata dell'impulso generato}
\[
V_{S-}= 3.49 \pm 0.03 \si{\V}
\]
\[
V_{OL}=\frac{V_{S-}}{\beta}=6.99 \si{\V}
\]
\[
\Delta= C_1 R_3 \ln(\frac{1-\frac{V_{\gamma}}{V_{OL}}}{1-\beta})= 782 \pm D A   C A L C O L A R E \si{\micro\s}
\]
Dalla misura diretta ricavo
\[
\Delta= 779 \pm 10 \;\si{\micro\s}
\]

\subsection{Analisi del funzionamento del circuito}

%=======================
\section*{Conclusioni e commenti finali}
Si è riusciti a costruire e studiare alcuni dei circuiti più comuni che si
possono realizzare con un amplificatore operazionale, tra cui: due filtri
attivi, passa-basso e passa-alto, un amplificatore di tensione invertente
(e uno non).
In particolare siamo riusciti ad apprezzare il differente comportamento dei
circuiti (anche in regime non lineare) dare una stima di guadagno, impedenza di
ingresso e frequenze caratteristiche della loro risposta in frequenza.

%=======================
\section*{Dichiarazione}
I firmatari di questa relazione dichiarano che il contenuto della relazione \`e
originale, con misure effettuate dai membri del gruppo, e che tutti i firmatari
hanno contribuito alla elaborazione della relazione stessa.

\newpage
\subsection*{Appendice}
Consideriamo il sotto-circuito formato dal condensatore $C_T$ e dal circuito
di formazione. La funzione di trasferimento che lega $V_s$ a $V\ped{sh}$ è
data di fatto da quella di un amplificatore invertente con impedenze
complesse: in trasformata di Laplace
\[
\tilde{A}(s) = - \frac{\left(\frac{1}{R_1} + s 
C_F\right)^{-1}}{\frac{1}{s C_T}} = - \frac{C_T}{C_F} 
\frac{s}{s + \frac{1}{\tau}}
\]
con $ \tau \coloneqq R_1 C_F $. In ingresso abbiamo un'onda quadra di 
periodo $ 2T $ (che prendiamo nulla per tempi negativi) che possiamo scrivere 
come
\[
V\ped{in}(t) = \sum_{k=0}^{+\infty} (-1)^{k}f(t - kT)
\qquad \text{dove} \quad
f(t) = V_s \left[\theta(t) - \theta(t - T)\right]
\]
In trasformata di Laplace si ha
\[
\tilde{f}(s) = V_s\left[\frac{1}{s} - \frac{e^{-sT}}{s}\right]
\]
da cui
\[
\tilde{V}\ped{in}(s) = \sum_{k=0}^{+\infty} (-1)^{k} \tilde{f}(s) e^{-kTs} = 
\tilde{f}(s) \sum_{k=0}^{+\infty} (-1)^{k} e^{-kTs}
\]
La risposta del circuito in trasformata è
\[
  \tilde{V}\ped{sh}(s) = \tilde{A}(s) \tilde{V}\ped{in}(s) =  
\tilde{A}(s)\tilde{f}(s) \sum_{k=0}^{+\infty} (-1)^{k}e^{-kTs} = \tilde{g}(s) 
\sum_{k=0}^{+\infty} (-1)^{k}e^{-kTs} = \mathcal{L}\left[\sum_{k=0}^{+\infty} 
(-1)^{k}g(t - kT)\right](s)
\]
Ora
\[
  \tilde{g}(s) = - V_s \frac{C_T}{C_F} \left[\frac{1}{s + 
\frac{1}{\tau}} - \frac{e^{-sT}}{s + \frac{1}{\tau}}\right]
\]
da cui, anti-trasformando
\[
  g(t) = - V_s \frac{C_T}{C_F} \left[e^{-t/\tau}\theta(t) - 
e^{-(t-T)/\tau} \theta(t - T) \right]
\]

Ma allora la risposta del circuito nel dominio del tempo è
\begin{align*}
  V\ped{sh}(t) &= - V_s \frac{C_T}{C_F} \left\{ 
\sum_{k=0}^{+\infty} (-1)^{k}e^{-\frac{t - kT}{\tau}}\theta(t - kT) - 
\sum_{k=0}^{+\infty} (-1)^{k} e^{-\frac{t- (k+1) T }{\tau}} \theta(t - (k+1)T ) 
\right\} \\
               &= - V_s \frac{C_T}{C_F} \left\{ e^{-\frac{t}{\tau}} 
\theta(t) - 2 \sum_{k=1}^{+\infty} (-1)^{k} e^{-\frac{t - kT}{\tau}} \theta(t - 
kT) \right\}
\end{align*}
ovvero, ignorando il transiente iniziale e supponendo $ \tau\ll T $\footnote{
La buona definizione della somma è assicurata dal fatto che (tralasciando le 
costanti fisiche)
\[ \sum_{k \geq 0} \theta(t-k) e^{-(t-k)} = \sum_{k=0}^{\lfloor t \rfloor} 
e^{-(t-k)} \leq \frac{e}{e-1} e^{-\{t\}}. \]
},
\begin{align}\label{eq:Vshaper}
V\ped{sh}(t) &\approx 2 V_s \frac{C_T}{C_F} \sum_{k=1}^{+\infty} 
(-1)^{k} e^{-\frac{t - kT}{\tau}} \theta(t - kT) \nonumber\\
               &\approx  2 V_s \frac{C_T}{C_F} \sum_{k=1}^{+\infty} 
(-1)^{k} e^{-\frac{t - kT}{\tau}} \chi_{[kT, (k+1)T]}(t)
\end{align}

\end{document}
