\documentclass[10pt,a4paper]{article}
\input{../../latex/preamble}
\input{../../latex/math}
\geometry{left=2cm, right=2cm, top=2cm, bottom=2cm}

% indexes subsections with letters, sections with numbers (1.a, 1.b, ...)
\renewcommand{\thesubsection}{\thesection.\alph{subsection}}

% lets graphicx know path where figures to be included are found
\graphicspath{{../figs/}}

\author{Gruppo 1.AC \\ Matteo Rossi, Bernardo Tomelleri}
\title{Es05A: Applicazioni non-lineari di amplificatori operazionali}
\begin{document}
\date{\today}
\maketitle

\setcounter{section}{0}

\section*{Misura componenti dei circuiti}
\begin{table}[htbp]
\centering
\begin{tabular}{cccccc}
\toprule
Resistenze $[\si{k\ohm}]$ & $R$ & $\sigma R$ & Capacità $[\si{n\F}]$ & $C$ &
$\sigma C$ \\
\midrule
\midrule
$R_1^Q$	  & 100.6 	& 0.8 	 & $C_T$ & 1.00		 & 0.04 \\
$R_1^T$	  & 9.94	& 0.08 	 & $C_F$ & 1.00		 & 0.04 \\
$R_2^T$	  & 2.19	& 0.03	 & $C_1$ & 96		 & 4	\\
$R_2^a$	  & 998		& 8		 & $C_2$ & 1.00		 & 0.04 \\
$R_3$	  & 998		& 8		 & & & \\
$R_4$	  & 998		& 8		 & & & \\
\bottomrule     
\end{tabular}
\caption{Valori di resistenza e capacità misurate per i componenti dei
circuiti studiati. \label{tab: rcmes_B}}

\begin{tabular}{cccccc}
\toprule
Resistenze $[\si{\ohm}]$ & $R$ & $\sigma R$ & Capacità $[\si{n\F}]$ & $C$ &
$\sigma C$ \\
\midrule
\midrule
$R_1^Q$	  & 99.8 	& 0.8 	 & $C_T$ & 1.00		 & 0.04 \\
$R_1^T$	  & 9.94	& 0.08 	 & $C_F$ & 1.00		 & 0.04 \\
$R_2^T$	  & 2.19	& 0.03	 & $C_1$ & 99		 & 4	\\
$R_2^A$	  & 9.87		& 0.08		 & $C_2$ & 1.00		 & 0.04 \\
$R_3^A$	  & 10.01		& 0.08		 & & & \\
$R_4^M$	  & 9.91		& 0.08		 & & & \\
\bottomrule     
\end{tabular}
\caption{Valori di resistenza e capacità misurate per i componenti dei
circuiti studiati. \label{tab: rcmes_M}}
\end{table}

Riportiamo per completezza anche i valori delle tensioni di alimentazione
continue per l'op-amp misurate con il multimetro
\begin{align*}
V_{CC} &= 4.99 \pm 0.03 \si{\V} \\
V_{EE} &= -4.99 \pm 0.03 \si{\V}
\end{align*}

Non è stato possibile misurare i valori di capacità dei condensatori nel
circuito con il multimetro, che ha un rumore di fondo abbastanza alto da
saturare sempre il fondo scala da $\SI{2}{n\F}$, per cui al posto delle loro
misure prendiamo i valori nominali e relativa tolleranza.

%=======================
\section{Circuito amplificatore di carica}
\subsection{Progettazione del circuito}
Si è costruito un amplificatore di carica a partire da un op-amp TL081CP come
quello in figura \ref{fig: ampschm}

\begin{figure}[htbp]
    \centering
	\includegraphics[scale=1.2]{Qamp}
    \caption{Schema circuitale dell'amplificatore di carica costruito.
    \label{fig: Qampschm}}
\end{figure}

In condizione di op-amp ideale gli ingressi $+, -$ sono dei circuiti aperti,
per cui la stessa corrente scorre attraverso $R_1$ ed $R_2$:
$V_+ = V_- \approx 0$.
Questo implica che
\begin{equation}\label{eq: Zin}
R\ped{in} \approx R_1
\end{equation}
allora per soddisfare la richiesta $5 \leq A_v \leq 10$ basta imporre
$5 R_1 \leq R_2 \leq 10 R_1$.

Dunque una volta fissata $R_1 = 1 \pm 1\% \; \si{k\ohm}$, dobbiamo avere
$\SI{5}{k\ohm} \leq R_2 \leq \SI{10}{k\ohm}$, di conseguenza scegliamo
$R_2 = 5.1 \pm 1\% \; \si{k\ohm}$, che corrisponde ad un guadagno
di centro banda $A\ped{v, atteso} = 5.1 \pm 2\%$ 

\subsection{Amplificazione di piccoli segnali}
Si è inviato all'ingresso di entrambi i circuiti un segnale sinusoidale di
ampiezza $v\ped{in} = 200 \pm 2 \; \si{m\V}$ ad una frequenza fissata
$5.01 \pm 0.05 \; \si{k\Hz}$.

Dunque abbiamo misurato l'ampiezza del segnale in uscita dal circuito con
$R_2^a = \SI{5.1}{k\ohm}$, che risulta $v\ped{out} = 1022 \pm 8 \; \si{m\V}$,
ottenendo così una stima del guadagno dell'amplificatore
$A_v = \dfrac{v\ped{out}}{v\ped{in}} = 5.11 \pm 0.06 $.

Consideriamo il sotto-circuito formato dal condensatore $ C\ped{T} $ e dal 
circuito di formazione. La funzione di trasferimento che lega $ 
V\ped{in} $ a $ V\ped{sh} $ è data di fatto da quella di un amplificatore 
invertente con impedenze complesse: in trasformata di Laplace
\[
\tilde{A}(s) = - \frac{\left(\frac{1}{R_{1}} + s 
C\ped{F}\right)^{-1}}{\frac{1}{s C\ped{T}}} = - \frac{C\ped{T}}{C\ped{F}} 
\frac{s}{s + \frac{1}{\tau}}
\]
con $ \tau \coloneqq R_{1} C\ped{F} $. In ingresso abbiamo un'onda quadra di 
periodo $ 2T $ (che prendiamo nulla per tempi negativi) che possiamo scrivere 
come
\[
V\ped{in}(t) = \sum_{k=0}^{+\infty} (-1)^{k}f(t - kT)
\qquad \text{dove} \quad
f(t) = V_{0} \left[\theta(t) - \theta(t - T)\right]
\]
In trasformata di Laplace si ha
\[
\tilde{f}(s) = V_{0}\left[\frac{1}{s} - \frac{e^{-sT}}{s}\right]
\]
da cui
\[
\tilde{V}\ped{in}(s) = \sum_{k=0}^{+\infty} (-1)^{k} \tilde{f}(s) e^{-kTs} = 
\tilde{f}(s) \sum_{k=0}^{+\infty} (-1)^{k} e^{-kTs}
\]
La risposta del circuito in trasformata è
\[
  \tilde{V}\ped{sh}(s) = \tilde{A}(s) \tilde{V}\ped{in}(s) =  
\tilde{A}(s)\tilde{f}(s) \sum_{k=0}^{+\infty} (-1)^{k}e^{-kTs} = \tilde{g}(s) 
\sum_{k=0}^{+\infty} (-1)^{k}e^{-kTs} = \mathcal{L}\left[\sum_{k=0}^{+\infty} 
(-1)^{k}g(t - kT)\right](s)
\]
Ora
\[
  \tilde{g}(s) = - V_{0} \frac{C\ped{T}}{C\ped{F}} \left[\frac{1}{s + 
\frac{1}{\tau}} - \frac{e^{-sT}}{s + \frac{1}{\tau}}\right]
\]
da cui, anti-trasformando
\[
  g(t) = - V_{0} \frac{C\ped{T}}{C\ped{F}} \left[e^{-t/\tau}\theta(t) - 
e^{-(t-T)/\tau} \theta(t - T) \right]
\]

Ma allora la risposta del circuito nel dominio del tempo è
\begin{align*}
  V\ped{sh}(t) &= - V_{0} \frac{C\ped{T}}{C\ped{F}} \left\{ 
\sum_{k=0}^{+\infty} (-1)^{k}e^{-\frac{t - kT}{\tau}}\theta(t - kT) - 
\sum_{k=0}^{+\infty} (-1)^{k} e^{-\frac{t- (k+1) T }{\tau}} \theta(t - (k+1)T ) 
\right\} \\
               &= - V_{0} \frac{C\ped{T}}{C\ped{F}} \left\{ e^{-\frac{t}{\tau}} 
\theta(t) - 2 \sum_{k=1}^{+\infty} (-1)^{k} e^{-\frac{t - kT}{\tau}} \theta(t - 
kT) \right\}
\end{align*}
ovvero, ignorando il transiente iniziale e supponendo $ \tau\ll T $\footnote{
La buona definizione della somma è assicurata dal fatto che (tralasciando le 
costanti fisiche)
\[ \sum_{k \geq 0} \theta(t-k) e^{-(t-k)} = \sum_{k=0}^{\lfloor t \rfloor} 
e^{-(t-k)} \leq \frac{e}{e-1} e^{-\{t\}}. \]
},
\begin{align}\label{eq:Vsh}
V\ped{sh}(t) &\approx 2 V_{0} \frac{C\ped{T}}{C\ped{F}} \sum_{k=1}^{+\infty} 
(-1)^{k} e^{-\frac{t - kT}{\tau}} \theta(t - kT) \nonumber\\
               &\approx  2 V_{0} \frac{C\ped{T}}{C\ped{F}} \sum_{k=1}^{+\infty} 
(-1)^{k} e^{-\frac{t - kT}{\tau}} \chi_{[kT, (k+1)T]}(t)
\end{align}
Per il circuito in esame i valori nominali sono $ C\ped{T} = C\ped{F} = 
\SI{1}{\nano\farad} $, $ R_{1} = \SI{100}{\kilo\ohm} $, da cui $ \tau = 
\SI{100}{\micro\second} $, e $ 2T = \SI{10}{\milli\second} $. Dopo un 
transiente $ t\ll\tau $ in uscita ci aspettiamo quindi di osservare dei picchi 
esponenzialmente decrescenti di segno alterno e di ampiezza pari al doppio del 
segnale in ingresso. \\

\paragraph{Discriminatore}
Ignorando ora il condensatore $ C_{1} $ che ha il solo scopo di rimuovere il 
rumore ad alte frequenze dal generatore, il sotto-circuito \texttt{X2} è un 
discriminatore con tensione di soglia $ V\ped{t} $ data dal partitore di 
tensione collegato al terminale ``--'' dell'OpAmp
\[
  V\ped{t} = (1 - 2\alpha) V\ped{G}
\]
dove $ 0\leq \alpha \leq 1 $ è la ``frazione'' di resistenza data dal 
potenziometro e $ V\ped{G} = \SI{15}{\volt} $ (valore nominale) è la tensione 
di alimentazione. In altri termini la tensione di soglia è variabile da $ 
\SI{-15}{\volt} $ a $ \SI{15}{\volt} $. Supponendo di essere sempre in regime 
di saturazione, l'uscita del circuito è data da
\[
  V\ped{out} = V\ped{G} \sgn\left(V\ped{sh} - V\ped{t}\right).
\]
Più esplicitamente, usando $ V\ped{in} = \SI{6}{\volt} $ ci aspettiamo $ 
V\ped{sh} = \SI{12}{\volt} $ (ampiezze picco-picco), pertanto:
\begin{itemize}
\item se $ V\ped{t} > \SI{6}{\volt} $, $ V\ped{out} = -V\ped{G} $ costante.
\item se $ \SI{0}{\volt} < V\ped{t} < \SI{6}{\volt} $, ci aspettiamo (in un 
periodo)
  \[
    V\ped{out}(t) =
    \begin{cases}
      V\ped{G} & 0 < t < h \\
      - V\ped{G} & h < t < 2T
    \end{cases}
  \]
  dove $ h $ è il tempo in cui il picco esponenzialmente decrescente è 
maggiore della tensione di soglia, ovvero
  \begin{equation} \label{eq:tot-ampiezza-durata}
    h = \tau \log\left(\frac{C\ped{F}}{C\ped{T}} 
\frac{V\ped{in}}{V\ped{t}}\right).
  \end{equation}
\item se $ \SI{-6}{\volt} < V\ped{t} < \SI{0}{\volt} $, ci aspettiamo (in un 
periodo)
  \[
    V\ped{out}(t) =
    \begin{cases}
      V\ped{G} & 0 < t < T \\
      - V\ped{G} & T < t < T + h' \\
      V\ped{G} & T + h' < t < 2T
    \end{cases}
  \]
  dove $ h' $ è il tempo in cui il picco esponenzialmente crescente è minore 
della tensione di soglia, ovvero
  \[
    h' = \tau \log\left(\frac{C\ped{F}}{C\ped{T}} 
\frac{V\ped{in}}{\abs{V\ped{t}}}\right).
  \]
\item se $ V\ped{t} < \SI{-6}{\volt} $, $ V\ped{out} = -V\ped{G} $ costante.
\end{itemize}

\setcounter{subsection}{3}
\subsection{Misure di guadagno al variare di $v\ped{in}$}
Misurando con l'oscilloscopio l'ampiezza dei segnali in ingresso $v\ped{in}$
e in uscita $v\ped{out}$ dall'amplificatore possiamo ricavare una misura del
guadagno del circuito dal rapporto $A_v = \dfrac{v\ped{out}}{v\ped{in}}$.

Con un fit lineare possiamo stimare il guadagno dell'amplificatore a partire
dal grafico di $v\ped{out} = A_v v\ped{in}$ al variare di $v\ped{in}$.
Riportiamo quanto trovato per il primo circuito:
\begin{figure}[htbp]
\centering
%\includegraphics[scale=0.7]{gain5k1}
\caption{Fit lineare per l'andamento dell'uscita rispetto al segnale in
ingresso. \label{fig: gainfit}}
\end{figure}
Da cui troviamo i seguenti parametri per la retta di best-fit
\begin{align*}
\mathrm{intercetta} = -0.6 \pm 0.4 \; \si{m\V} \;\;\;\mathrm{pendenza} = 5.124 
\pm 0.003 \;\;\;\mathrm{correlazione} 
= -0.72 \;\;\; \chi^2 = 0.2 \;\;\; d.o.f. = 10 \\
\text{coefficiente angolare/senza intercetta} = 5.120 \pm 0.002 \;\;\;
\chi^2 = 0.2 \;\;\; d.o.f. = 11
\end{align*}

Il valore atteso per il guadagno dal valore dei componenti in questa
configurazione del circuito è pari a
\[
A\ped{v, exp} = -\frac{R_2}{R_1} = - 5.13 \pm 0.12
\]
Questo è in ottimo accordo con quanto trovato sperimentalmente dalla nostra
analisi.

Per completezza riportiamo in un grafico anche le misure che non abbiamo
considerato nel fit perché oltre la regione in cui l'op-amp ha comportamento
lineare
\begin{figure}[htbp]
\centering
%\includegraphics[scale=0.7]{gainsat}
\caption{Andamento reale dell'uscita al variare dell'ampiezza del segnale in
ingresso oltre il regime lineare dell'amplificatore misurati per il circuito
con $R_2^a = 5.1 \; \si{k\ohm}$ \label{fig: gainsat}}
\end{figure}

\subsection{Durata impulso per carica di test}
Abbiamo misurato per $V_s = 999 \pm 8 \si{m\V}$ di ampiezza dell'onda quadra
in ingresso, frequenza $f = 100.0 \pm 1.6 \; \si{k\Hz}$, dunque come carica
$Q\ped{in} = C_T \cdot V_s = 0.99 \pm 0.04 \; \si{n\coulomb}$.

L'impulso in uscita ha durata pari a $415 \pm 5 \; \si{\micro\s}$ in un circuito e $410 \pm 5 \; \si{\micro\s}$ nel secondo.

\subsection{Andamento di TOT al variare di $Q\ped{in}$}

Provando con varie ampiezza in ingresso, in entrambi i circuiti si sono verificati i medesimi risultati: per ampiezze dei segnali in ingresso maggiori dei 50 mV non sono presenti particolari deformazioni nel segnale in uscita; al di sotto dei 50 mV invece il segnale in uscita inizia a deformarsi, assumendo la forma di una parabola rovesciata che si sposta verso il basso più diminuiamo l'ampiezza in ingresso; questo comportamento si osserva fino a circa 30 mV, quando il segnale in uscita diventa impercettibile e scompare.

%=======================
\section{Trigger di Schmitt}

\begin{figure}[htbp]
    \centering
	\includegraphics[scale=1.5]{trgSchmitt}
    \caption{Schema circuitale del trigger di Schmitt costruito.
    \label{fig: trgschmittschm}}
\end{figure}

\subsection{Risposta ad un'onda sinusoidale}

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.4]{schmitt}
\caption{risposta ad un segnale sinusoidale di ampiezza 1 V e frequenza 100 Hz del trigger di schmitt}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.4]{shmitt_isteresi}
\caption{risposta ad un segnale sinusoidale di ampiezza 2 V e frequenza 100 Hz del trigger di schmitt, visto nel piano XY in cui il segnale in ingresso è sulle x e il segnale in uscita sulle y}
\end{figure}


\subsection{Saturazione dell'OpAmp}

\[
V_{S+} = 4.21 \pm 0.04 \; \si{\V}
\]
\[
V_{S-} = -3.53 \pm 0.03 \; \si{\V}
\]
\subsection{Tensioni di soglia e funzionamento del trigger}
Abbiamo inviato in ingresso all'amplificatore un'onda sinusoidale di ampiezza
$1999 \pm 15 \; \si{m\V}$ e frequenza $1000 \pm 16 \; \si{\Hz}$.
Dalle intersezioni tra i due canali abbiamo misurato le transizioni basso-alto
(OH) e alto-basso (OL)

\[
V_{OH} = 617 \pm 5 \; \si{m\V}
\]
\[
V_{OL} = 782 \pm 6 \; \si{m\V}
\]
Per il secondo circuito invece è stata fatta una media pesata sui punti sulle 2 linee verticali che si formano nel grafico XY (ovviamente una per ogni linea).
\[
V_{OH} = 611.6 \pm 0.5 \; \si{m\V}
\]
\[
V_{OL} = 780.4 \pm 0.5 \; \si{m\V}
\]
\subsection{Limiti fisici del circuito}
\[
F_{L} = 92.6 \pm 0.1 \; \si{k\Hz}
\]
\[
SR = 11.1 \pm 0.3 \; \si{k\Hz}
\]
\begin{figure}[htbp]
\centering
\includegraphics[scale=0.4]{schmitt_freq}
\caption{analisi in frequenza del trigger di schmitt, in particolare l'unico punto di interesse si trova a circa 90 kHz, punto in cui smette di funzionare}
\end{figure}
%=======================
\section{Multivibratore astabile}

\begin{figure}[htbp]
    \centering
	\includegraphics[scale=1.5]{astable}
    \caption{Schema circuitale del multivibratore astabile costruito.
    \label{fig: astableschm}}
\end{figure}

\subsection{Funzionamento del circuito}
\[
\beta= \frac{R_1}{R_1 + R_2}
\]
\[
T = 2 R_3 C_1 \ln(\frac{1+\beta}{1-\beta})
\]


\setcounter{subsection}{2}
\subsection{Studio dei segnali in ingresso e uscita}
Si è inviato all'ingresso del filtro passa-alto un segnale triangolare di
ampiezza $v\ped{in} = 200 \pm 2 \si{m\V}$ e frequenza
$f = 100.0 \pm 1.6 \si{\Hz}$.

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.4]{V+Vout}
\caption{Grafico segnale in $V_+$ e segnale in $V_{out}$}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.4]{V-Vout}
\caption{Grafico segnale in $V_-$ e segnale in $V_{out}$}
\end{figure}


\subsection{Misure di periodo e duty cycle}

\[
DC = 0.482 \pm 0.013
\]
\[
T = 2.15 \pm 0.02 \si{m\s}
\]
\[
T_{atteso} = 2.17 \pm  D A   C A L C O L A R E \si{m\s}
\]

\subsection{Limite massimo in frequenza del generatore}

%=======================
\section{Multivibratore monostabile}
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=1.2]{monostable}
    \caption{Schema circuitale del multivibratore monostabile costruito.
    \label{fig: monostableschm}}
\end{figure}

\subsection{Studio dei segnali in ingresso e uscita}

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.42]{monostabile}
\caption{Grafico segnale in ingresso e $V_{out}$}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.42]{monostabileV+}
\caption{Grafico segnale in $V_{+}$ e $V_{out}$}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.42]{monostabileV-}
\caption{Grafico segnale in $V_{-}$ e $V_{out}$}
\end{figure}

\subsection{Durata dell'impulso generato}
\[
V_{S-}= 3.49 \pm 0.03 \si{\V}
\]
\[
V_{OL}=\frac{V_{S-}}{\beta}=6.99 \si{\V}
\]
\[
\Delta= C_1 R_3 \ln(\frac{1-\frac{V_{\gamma}}{V_{OL}}}{1-\beta})= 782 \pm D A   C A L C O L A R E \si{\micro\s}
\]
Dalla misura diretta ricavo
\[
\Delta= 779 \pm 10 \;\si{\micro\s}
\]

\subsection{Analisi del funzionamento del circuito}

%=======================
\section*{Conclusioni e commenti finali}
Si è riusciti a costruire e studiare alcuni dei circuiti più comuni che si
possono realizzare con un amplificatore operazionale, tra cui: due filtri
attivi, passa-basso e passa-alto, un amplificatore di tensione invertente
(e uno non).
In particolare siamo riusciti ad apprezzare il differente comportamento dei
circuiti (anche in regime non lineare) dare una stima di guadagno, impedenza di
ingresso e frequenze caratteristiche della loro risposta in frequenza.

%=======================
\section*{Dichiarazione}
I firmatari di questa relazione dichiarano che il contenuto della relazione \`e
originale, con misure effettuate dai membri del gruppo, e che tutti i firmatari
hanno contribuito alla elaborazione della relazione stessa.

\end{document}
