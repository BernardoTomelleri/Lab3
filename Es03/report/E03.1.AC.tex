\documentclass[10pt,a4paper]{article}
\input{../../latex/preamble}
\input{../../latex/math}
\geometry{left=2cm, right=2cm, top=2cm, bottom=2cm}
\newcommand{\rem}[1]{[\emph{#1}]}
\newcommand{\exn}{\phantom{xxx}}

% lets graphicx know path where figures to be included are found
\graphicspath{{../figs/}}

\author{Gruppo 1.AC \\ Matteo Rossi, Bernardo Tomelleri}
\title{Es03A: Amplificatore a transistor}
\begin{document}
\date{\today}
\maketitle

\setcounter{section}{0}

\section*{Misura componenti}
\begin{table}[ht]
\centering
\begin{tabular}{cccccc}
\toprule
Resistenze $[\si{\ohm}]$ & $R$ & $\sigma R$ & Capacità $[\si{\F}]$ & $C$ &
$\sigma C$ \\
\midrule
\midrule
$R_C$		  & 5.06 k	& 0.4 k	 & $C\ped{in}$  & 0.23 $\rm \mu$ & 0.01 $\rm \mu$ \\
$R_{E_p}$	  & 992		& 8      & $C\ped{out}$ & 104 n			 & 4	\\
$R_{E_q}$	  & 993		& 8      & $C_E$        & 90 $\rm \mu$	 & 5	\\
$R_{E}$		  & 496		& 4      &              &				 &		\\
$R_{1_s}$	  & 19.87 k & 0.16 k &              &				 &		\\
$R_{1_t}$	  & 50.5 k  & 8 k	 &              &				 &		\\
$R_1$		  & 70.4 k  & 0.6 k	 &              &				 &		\\
$R_2$		  & 9.93 k  & 0.08 k &              &				 &		\\
$R\ped{es_p}$ & 100.5	& 0.8    &				&				 &		\\
$R\ped{es_q}$ & 100.2	& 0.8    &				&				 &		\\
$R\ped{es}$   & 50.5	& 0.5    &				&				 &		\\
\bottomrule     
\end{tabular}
\caption{Valori di resistenza e capacità misurate per i componenti del
circuito \label{tab: rcmes}}
\end{table}

\section{Verifica del punto di lavoro}
\subsection*{1.a Componenti quiescenti}

La frequenza nominale di taglio \`e stata fissata a $f_1 = 7337 \si{\Hz} \;\; 
\Rightarrow |A_v(3\,\mathrm{kHz})| = 0.93 \;\; |A_v(30\,\mathrm{kHz})| = 0.23$  

Abbiamo scelto $ f\ped{1 teo} = \SI{6}{\kilo\hertz} $, così da attenuare
il segnale a \SI{3}{\kilo\hertz} di un fattore $\sim 1 $ e quello a 
\SI{30}{\kilo\hertz} di un fattore $1/\sqrt{1 + (30/6)^2} \approx
\nicefrac{1}{5}$, per avere un fattore di soppressione di circa 4. Siamo giunti
a questa scelta attraverso le seguenti considerazioni:

Dette $f_l = \SI{3}{\kilo\hertz}$ e $f_h = \SI{30}{\kilo\hertz}$ definiamo
il fattore di soppressione del filtro come il rapporto tra le attenuazioni
attese alle due frequenze di interesse:
\[
\mathcal{S}^2(f_1) := 
\frac{\abs{A(f_l)}^2}{\abs{A(f_h)}^2} = \frac{f_1^2 + 
f_l^2}{f_1^2 + f_h^2}
\]
questa è una funzione decrescente di $f_1$ con massimo in 
$f_1 = \SI{0}{\hertz}$ pari a $\mathcal{S}(f_1 = 0) = \nicefrac{f_l}{f_h}$;
Però la scelta $f_1 = \SI{0}{\hertz}$ oltre a non essere realizzabile
praticamente avrebbe $A(f) \sim 0 $ per tutte le frequenze di nostro interesse
($\geq 3 \si{k\Hz}$) su cui il circuito avrebbe sempre lo stesso comportamento,
che va contro a quanto vogliamo.

Idealmente vorremmo $f_1$ il più ``piccola'' possibile, ma non minore
di $f_l$ per ridurre attenuazioni e sfasamenti indesiderati del segnale
a bassa frequenza, ma ``sufficientemente'' minore di $f_h $ affinché il
segnale ad alta frequenza venga apprezzabilmente ''tagliato''. Ovverosia
$f_l \ll f_1 \ll f_h$; però, dal momento che $f_h = 10 \cdot f_l$ tra i due
estremi di frequenza c'è solo un ordine di grandezza, siamo costretti a
cercare un compromesso ragionevole: $f_l \leq f_1 \leq f_h$.

Visto che il filtro raggiunge un fronte di discesa di pendenza modesta
($-20$ dB/decade) soltanto quando $f \gg f_1$ scegliamo $f_1$ decisamente
più lontana da $f_h = 5 \cdot f_1$ che da $f_l = \frac{1}{2} f_1$:
di modo che il segnale a $f_h$ venga adeguatamente soppresso, mentre quello
a $f_l$ rimanga il più possibile indisturbato.

Infine la scelta tra i valori disponibili di $R_1$ e $C_1$ ci ha portato alla
frequenza di taglio nominale più vicina a quella teorica di 
$f_1 = 7.3 \pm 0.3 \; \si{k\Hz}$. 

\subsection*{1.b Tensioni ai terminali}

I valori nominali scelti sono $R_1 = 2 \pm 1\% \; \si{k\ohm} \;\; 
C_1 = 10 \pm 10\% \; \si{n\F}$.  

Affinché il passa basso non venga perturbato dal carico a valle
$R\ped{L} = \SI{100}{\kilo\ohm}$, l'impedenza in uscita dal circuito
$Z\ped{out}(\omega)$ dev'essere trascurabile rispetto a quella del carico.
\[
\abs{Z\ped{out}} = \abs{\left(\frac{1}{R_1} + j\omega 
C_1\right)^{-1}} \ll R\ped{L} \implies R_1 \ll
R\ped{L} \sqrt{1 + \omega^2 R_1^2 C_1^2} =
R\ped{L} \sqrt{1 + \left(\frac{f}{f_1}\right)^2}.
\]
Dunque dobbiamo avere
\[
R_1 \ll \SI{100}{\kilo\ohm}  \ \sqrt{1 + 
\left(\frac{f_l}{f_1}\right)^2} \approx \SI{112}{\kilo\ohm}.
\]
Abbiamo quindi scelto $R\ped{1 teo} = \SI{2}{\kilo\ohm}$.
Per cui prendiamo $C\ped{1 teo} =
\ds \frac{1}{2\pi R\ped{1 teo} f\ped{1 teo}} \approx \SI{8}{\nano\farad}$. 
\subsection*{1.c Partitore ``stiff''}
\[
C_1 = 10.9 \pm 0.4 \si{n\F}
\]
Compatibile entro la tolleranza con il valore nominale.

\section{Risposta a segnali sinusoidali}

\subsection*{2.a Inversione di fase}
La nostra stima della frequenza per cui $A_v$(dB) = -3 dB \`e
\[
f_{1A} = 7336 \pm 6 \; \si{\Hz}
\]

\subsection*{2.b Guadagno per piccoli segnali}
Dal fit a bassa frequenza ($f\ll f_1$) otteniamo
\[
A_1(\mathrm{dB}) = \left(-17.91 \pm 0.18\right)\times 10^{-3} \;\;\;
\chi^2 = 243 \;\;\; d.o.f. = 873
\]

Ad alta frequenza ($f \gg f_1$) la retta di best-fit al plot di Bode in 
ampiezza ha i seguenti parametri:
\[
\mathrm{intercetta} = 75.928 \pm 0.008 \;\;\;\mathrm{pendenza} = -19.6747 \pm 
0.0016 \;\;\;\mathrm{correlazione} 
= -0.997 \;\;\; \chi^2 = 1647 \;\;\; d.o.f. = 1746
\]
Dall'intersezione delle due rette stimiamo per la frequenza di taglio il valore
\[
f_{1B} = 7246 \pm 8 \; \si{Hz}
\]

\begin{figure}[htbp]
\centering
%\includegraphics[scale=0.7]{corner}
\caption{Fit al plot di bode per trovare la frequenza di corner. In verde i
punti non utilizzati nel fit. \label{fig: corner}}
\end{figure}

\subsection*{2.c Linearità del circuito}
Dal fit complessivo del modulo della funzione di trasferimento
\begin{equation}\label{eq: lpfgain}
\abs{T(f)} = A(f) = \frac{1}{\sqrt{1 + \left(\frac{f}{f_1}\right)^2}}
\end{equation}
otteniamo per l'~amplificazione di centro-banda e per la frequenza di taglio i 
seguenti valori:
\[
A_1 (\mathrm{dB}) = \left(-19.1 \pm 0.3\right)\times 10^{-3} \;\;\;
f_{1C} = 7428.8 \pm 0.9 \si{\Hz} \;\;\;\ \chi^2 = 1614 \;\;\; d.o.f.= 4997
\]

\begin{figure}[htb]
\centering
%\includegraphics[scale=0.7]{lpfbodefit}
\caption{Fit complessivo al plot di bode con l'espressione per l'attenuazione
\eqref{eq: lpfgain}.\label{fig: lpfbodefit}}
\end{figure}


\subsection*{2.d Clipping}
Le misure delle frequenze di taglio trovate sono tutte compatibili con il valore atteso dato dai componenti.

\section{Impedenze in ingresso e uscita}
Il fronte del segnale di uscita ha un tempo di salita, misurato con i cursori, 
di 
\[
t_r = 47 \pm 2 \; \si{\micro\second}
\]
da cui 
\[
f_1 = \ln(9) R_1 C_1 \approx \frac{2.2}{2\pi t_r} = 7.4 \pm 0.3 \; \si{k\Hz}
\]

\subsection*{3.a Impedenza di ingresso}
L'impedenza in ingresso al circuito in \ref{fig: lpfcirc} è data da:
\[
Z\ped{in}(\omega) = R_1 + \frac{1}{j \omega C_1} =
R_1 \left( 1 - j \frac{1}{\omega R_1 C_1} \right) =
R_1 \left( 1 - j \frac{\omega_1}{\omega} \right)
\]

A bassa frequenza ($f \ll f_1$) il termine costante è trascurabile, per cui
\[
Z\ped{in}(f) \approx -jR_1 \frac{f_1}{f}
\]
Poiché l'impedenza del condensatore $Z_{C_1} \to \infty$ per $f \to 0$
il filtro si comporta come un circuito aperto.

Ad alta frequenza ($f \gg f_1$) è il termine costante a dominare, quindi
\[
Z\ped{in} \approx R
\]
cioè, nel limite opposto ($Z_{C_1} \to 0$ per $f \to \infty$) il
condensatore si comporta come un corto-circuito, quindi il filtro ha
impedenza puramente reale.

Alla frequenza di taglio vale
\[
Z\ped{in} = R_1 (1 - j)
.\]

Mentre come impedenza in uscita abbiamo:
\[
Z\ped{out}(\omega) = \left(\frac{1}{R_1} + j\omega C_1\right)^{-1}
.\]

\subsection*{3.b Impedenza di uscita}
(Qui \`e richiesto che valutiate l'~amplificazione di centro-banda e la 
frequenza di taglio nel 
caso in cui il carico sia rispettivamente 100 e 10 k$\Omega$)
\[
\begin{array}{rl}
R_L=100 \,k\Omega & \implies A_1 = 0.98 \;\;\; f_1 = 7450 \\
R_L=10 \,k\Omega & \implies A_1 = 0.83\;\;\; f_1 = 8761 \\
\end{array}
\]
% Si vede dal circuito equivalente di Thèvenin che la tensione vista dal
% condensatore è quella in uscita dal partitore di tensione
% $V_C = R_L/(R_1 + R_L) e che la resistenza a cui si trova in serie è il
% parallelo di $R_1 || R_2 = (1/R_1 + 1/R_2)^{-1}$ che alza la frequenza
% di taglio rispetto al valore atteso.

%=======================
\section{Risposta in frequenza}

\subsection*{4.a Network Analyzer}
\begin{align*}
R_1 = 1.98 \pm 0.02 \; \si{k\ohm} \quad C_1 = 10.8 \pm 0.4 \; \si{n\F} \quad
f_1 = 7442 \pm 351 \; \si{\Hz}
\end{align*}

\subsection*{4.b Stima delle frequenze di taglio}
Dalla fit con la funzione di trasferimento del passa basso risulta:
\begin{figure}[htb]
\centering
%\includegraphics[scale=0.4]{passa_basso}
\caption{Fit con il modello della funzione di trasferimento per il filtro passa basso}
\end{figure}
Il valore della frequenza di taglio vale invece:
\begin{align*}
f_1 = 7.76 \pm 0.01 \; \si{k\Hz}\\
\end{align*}
che è compatibile con i valori attesi.

Il guadagno a centro banda vale:
\begin{align*}
A_1 = (-23 \pm 61) \times 10^{-3} \; \si{dB}
\end{align*}

\section*{Aumento del guadagno}
\begin{align*}
R_2 = 1.98 \pm 0.02 \; \si{k\ohm} \quad C_1 = 97.6 \pm 3.9 \; \si{n\F} \quad
f_1 = 821 \pm 41 \; \si{\Hz}
\end{align*}

\subsection*{5.a Guadagno a 10 kHz}
Dal fit con modello la funzione di trasferimento di un filtro passa alto risulta:
\begin{figure}[htb]
\centering
%\includegraphics[scale=0.4]{passa_alto}
\caption{Fit con il modello della funzione di trasferimento per il filtro passa alto}
\end{figure}
Il valore della frequenza di taglio ricavata dal fit vale:
\begin{align*}
f_2 = 821.3 \pm 0.2 \; \si{Hz}
\end{align*}
Il guadagno a centro banda vale:
\begin{align*}
A_2 = (-25 \pm 61) \times 10^{-3} \; \si{dB}
\end{align*}
\subsection*{5.b Confronto con il guadagno atteso}
La nostra stima dell'amplificazione di centro-banda e delle frequenze di 
taglio (per cui il guadagno si riduce di 3 dB rispetto a centro-banda) \`e
\[
A(\mathrm{dB}) = -6.505 \pm 0.006 \;\;\; f_{L} = 380 \pm 3 \si{\Hz} \;\;\;
f_{H} = 16.29 \pm 0.16 \si{k\Hz}
\]

\iffalse
\subsection*{10.b Fit della funzione di trasferimento}
Utilizzando come modello la funzione di trasferimento per il passa banda si ottiene:

\begin{figure}[htb]
\centering
\includegraphics[scale=0.35]{passa_banda}
\caption{Fit con il modello della funzione di trasferimento per il filtro
passa banda}
\end{figure}


Dal fit del plot di Bode in ampiezza si ha
\[
A(\mathrm{dB}) = \ldots \pm \ldots \;\;\;f_{L} = \ldots\pm \ldots\;\;\;f_{H} = 
\ldots\pm 
\ldots\;\;\;\chi^2 = \ldots\;\;\; d.o.f.= \ldots
\]

\subsection*{10.c Differenze}
A differenza dei circuiti RC studiati prima, non possiamo considerare
indipendenti i sotto-circuiti che compongono il passa-banda; infatti il
comportamento reale del circuito è sensibilmente diverso da quanto previsto in 
approssimazione di stadi indipendenti.

In particolare a centro banda (i.e. nell'intervallo di frequenza
$f_2 \leq f \leq f_1$) l'attenuazione non è più in ottima approssimazione
unitaria, ma è minore di $A\ped{max}(f) \approx \SI{-6}{\dB/dec}$.

Le frequenze di taglio misurate $f_L$ e $f_H$ non sono compatibili con quelle
ottenute separatamente nell'analisi dei singoli circuiti. Più precisamente
la frequenza più bassa (del passa alto) è pressoché dimezzata
$f_L > f_2$, mentre la frequenza più alta (del passa basso) è più che
raddoppiata $f_H > f_1$.

D'altra parte, una ragionevole richiesta per assicurare l'indipendenza dei due
circuiti collegati in serie è che si abbia
$\abs{Z\ped{out, 1}} \ll \abs{Z\ped{in,2}}$ ad ogni frequenza (e 
indipendentemente da questa). Riportiamo le impedenze in questione:
\[
\abs{Z\ped{out, 1}} = \abs{\frac{R_1}{1 + j \omega R_1 C_1}}^2 = 
\frac{R_1^2}{1 + \omega^2 R_1^2 C_1^2}
\qquad
\abs{Z\ped{in, 2}}^2 = \abs{\frac{1 + j \omega R_2 C_2}{j\omega 
C_2}}^2 = \frac{1 + \omega^2 R_2^2 C_2^2}{\omega^2 C_2^2}
\]
Ora $\abs{Z\ped{out, 1}} \leq 1/(\omega C_1)$ con $\abs{Z\ped{out, 
1}} \sim 1/(\omega C_1)$ per $f \gg f_1 $ e $\abs{Z\ped{in, 2}} 
\geq 1/(\omega C_2)$ con $\abs{Z\ped{out, 1}} \sim 1/(\omega C_2) 
$ per $ f \ll f_2 $. Quindi per poter considerare indipendenti i due circuiti
è sicuramente una buona idea imporre la condizione
\[
\abs{Z\ped{out, 1}} \leq \frac{1}{\omega C_1} \ll \frac{1}{\omega C_2} \leq 
\abs{Z\ped{in, 2}} \implies C_2 \ll C_1.
\]
Mentre per i valori di capacità scelti vale la condizione opposta
$C_2 \approx 10 \cdot C_1$.

\subsection*{10.d Dipendenza dai valori delle resistenze}
Se indichiamo con $A_1(f)$ e $A_2(f)$ le attenuazioni del passa-basso e del
passa-alto, l'attenuazione attesa in uscita dai due circuiti collegati in
cascata è
\begin{equation}\label{eq: bpfgain}
A = \left(\frac{R_1}{R_2} + \frac{1}{A_1 A_2}\right)^{-1} = 
\frac{A_1 A_2}{A_1 A_2 \frac{R_1}{R_2} + 1} 
\end{equation}
Nel nostro caso vale $R_1 = R_2$ (entro l'incertezza) per cui come
attenuazione di centro banda, dove avevamo $A_1 \approx A_2 \approx 1$, ci
aspettiamo di avere $A\ped{cb} = \frac{1}{2}$.
Questo è compatibile con il valore che abbiamo misurato (prima in dB)
$A\ped{cb} = 0.4702 \pm 0.0004 \approx \frac{1}{2}$

Per avere una risposta in frequenza del circuito complessivo il più possibile
uguale al prodotto delle funzioni di trasferimento dei due sotto-circuiti
avremmo dovuto scegliere $R_1 \ll R_2$ ($Z\ped{out, 1} \ll Z\ped{in, 2}$.
Infatti l'attenuazione attesa a centro banda vista in \eqref{eq: bpfgain}
sotto queste ipotesi diventa $A\ped{cb} \approx A_1 A_2 \approx 1$.
\subsection*{10.e Andamento della fase}
Idealmente, se la funzione di trasferimento complessiva $T(\omega)$ per il
passa banda è il prodotto delle funzioni di trasferimento dei due circuiti in
cascata:
\begin{align*}
T_1(\omega) = -\frac{1}{1 + j \omega/\omega_1} \qquad
T_2(\omega) = \frac{1}{1 - j \omega_2/\omega}
\end{align*}
ci aspettiamo (per le regole di moltiplicazione sui complessi) che lo
sfasamento totale in uscita sia pari alla somma degli sfasamenti prodotti dai
singoli sotto-circuiti:
\[
T(\omega) = T_1(\omega) T_2(\omega) =
\abs{T_1} e^{i (\omega t + \phi_1)} \abs{T_2} e^{i (\omega t + \phi_2)} =
\abs{T_1} \abs{T_2} e^{i (\omega t + \phi_1 + \phi_2)} =
\abs{T_1} \abs{T_2} e^{i (\omega t + \phi)}
\]
per cui $\phi = \phi_1 + \phi_2 =
\tan^{-1} \left( \dfrac{\Im{\{T_1(\omega)\}}}{\Re{\{T_1(\omega)\}}} \right) +
\tan^{-1} \left( \dfrac{\Im{\{T_2(\omega)\}}}{\Re{\{T_2(\omega)\}}} \right)$
che corrispondono rispettivamente a
\begin{align*}
\phi_1(\omega) = \arctan - \frac{\omega}{\omega_1} \qquad
\phi_2(\omega) = \arctan \frac{\omega_2}{\omega}
\end{align*}

Effettivamente le misure di sfasamento in uscita dal passa-banda risultano
in accordo con l'andamento atteso
\begin{equation}
\phi_2 + \phi_1 = \phi(f) = \arctan{\frac{f_2}{f}} - \arctan{\frac{f}{f_1}}
\end{equation}
\begin{figure}[htb]
\centering
\includegraphics[scale=0.7]{bpfphase}
\caption{Grafico dello sfasamento misurato per il filtro passa-banda al
variare della frequenza in scala semilogaritmica.}
\end{figure}
almeno fino a frequenze dell'ordine di $10^5 \; \si{\Hz}$ dove i punti
iniziano a deviare dal modello man mano che ci si avvicina alla banda
passante dell'AD2 $(\sim 9 \; \si{M\Hz})$. Questo può essere dovuto alle
capacità parassite tra i fili, i componenti e la basetta che ad alta
frequenza non sono trascurabili, a differenza di quanto presuppone il nostro
modello.

\section*{Conclusioni e commenti finali}
Si è riusciti a realizzare dei filtri RC passivi del primo ordine
(o ``a un polo'') e ad apprezzarne il differente comportamento in vari
regimi, quando usati separatamente, collegati in cascata e connessi a
carichi resistivi di diverso valore.

\begin{figure}[htb]
\centering
\includegraphics[scale=0.33]{noisine}
\caption{Sia nel dominio del tempo che delle frequenze si vede come il filtro
passa-basso progettato riesca ad attenuare sensibilmente il rumore a
$\SI{30}{k\Hz}$ sovrapposto al segnale portante di frequenza $\SI{3}{k\Hz}$.}
\end{figure}
\fi

\section*{Dichiarazione}
I firmatari di questa relazione dichiarano che il contenuto della relazione \`e 
originale, con misure effettuate dai membri del gruppo, e che tutti i firmatari 
hanno contribuito alla elaborazione della relazione stessa.

\end{document}
