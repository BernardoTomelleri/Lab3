\documentclass[10pt,a4paper]{article}
\input{../../latex/preamble}
\input{../../latex/math}
\geometry{left=2cm, right=2cm, top=2cm, bottom=2cm}
\newcommand{\rem}[1]{[\emph{#1}]}
\newcommand{\exn}{\phantom{xxx}}

% lets graphicx know path where figures to be included are found
\graphicspath{{../figs/}}

\author{Gruppo 1.AC \\ Matteo Rossi, Bernardo Tomelleri}
\title{Es02A: Circuito RC -- Filtri passivi}
\begin{document}
\date{\today}
\maketitle

\setcounter{section}{1}

\section*{Filtro passa-basso}
\subsection*{1.a Progettazione circuito RC passa--basso}
\begin{figure}[ht]
    \centering
    \begin{circuitikz}
        \draw (0,2) node[ocirc, label=$ V\ped{in} $]{}
        to[R=$R_{1}$] (3,2)
        to[C=$ C_{1} $] (3,0) node[ground]{};
        % \node[ground] at (2,0){};
        \draw (3,2) to (4,2) node[ocirc, label=$ V\ped{out} $]{};
    \end{circuitikz}
    \caption{Schema di massima del passa--basso. \label{fig:lpfcirc}}
\end{figure}

\subsection*{1.b Scelta della frequenza di taglio}

La frequenza nominale di taglio \`e stata fissata a $f_1 = 7337 \si{\Hz} \;\; 
\Rightarrow |A_v(3\,\mathrm{kHz})| = 0.93 \;\; |A_v(30\,\mathrm{kHz})| = 0.23$  

Abbiamo scelto $ f\ped{1 teo} = \SI{6}{\kilo\hertz} $, così da attenuare
il segnale a \SI{3}{\kilo\hertz} di un fattore $\sim 1 $ e quello a 
\SI{30}{\kilo\hertz} di un fattore $1/\sqrt{1 + (30/6)^2} \simeq
\nicefrac{1}{5}$, per avere un fattore di soppressione di circa 4. Siamo giunti
a questa scelta attraverso le seguenti considerazioni:

Dette $f_{l} = \SI{3}{\kilo\hertz}$ e $f_{h} = \SI{30}{\kilo\hertz}$ definiamo
il fattore di soppressione del filtro come il rapporto tra le attenuazioni
attese alle due frequenze di interesse:
\[
\mathcal{S}^{2}(f_1) := 
\frac{\abs{A(f_{l})}^{2}}{\abs{A(f_{h})}^{2}} = \frac{f_1^{2} + 
f_{l}^{2}}{f_1^{2} + f_{h}^{2}}
\]
questa è una funzione decrescente di $f_1$ con massimo in 
$f_1 = \SI{0}{\hertz}$ pari a $\mathcal{S}(f_1 = 0) = \nicefrac{f_l}{f_h}$;
Però la scelta $f_1 = \SI{0}{\hertz} $ oltre a non essere realizzabile
praticamente avrebbe $A(f) \sim 0 $ per tutte le frequenze di nostro interesse
($\geq 3 \si{k\Hz}$) su cui il circuito avrebbe sempre lo stesso comportamento,
che va contro a quanto vogliamo.

Idealmente vorremmo $f_1 $ il più ``piccola'' possibile, ma non minore
di $ f_l $ per ridurre attenuazioni e sfasamenti indesiderati del segnale
a bassa frequenza, ma ``sufficientemente'' minore di $f_h $ affinché il
segnale ad alta frequenza venga apprezzabilmente ''tagliato''. Ovverosia
$f_l \ll f_1 \ll f_h$; però, dal momento che $f_h = 10 \cdot f_l$ tra i due
estremi di frequenza c'è solo un ordine di grandezza, siamo costretti a
cercare un compromesso ragionevole: $f_l \leq f_1 \leq f_h$.

Visto che il filtro raggiunge un fronte di discesa di pendenza modesta
($-20$ dB/decade) soltanto quando $f \gg f_1$ scegliamo $f_1$ decisamente
più lontana da $f_h = 5 \cdot f_1$ che da $f_l = \frac{1}{2} f_1$:
di modo che il segnale a $f_l$ venga adeguatamente soppresso, mentre quello
a $f_l$ rimanga il più possibile indisturbato.

Infine la scelta tra i valori disponibili di $R_1$ e $C_1$ ci ha portato alla
frequenza di taglio nominale più vicina a quella teorica di 
$f_1 = 7.3 \pm 0.3 \si{k\Hz}.$ 

\subsection*{1.c,1.d Scelta dei componenti}

I valori nominali scelti sono $R_1 = 2 \pm 1\% \; \si{k\ohm} \;\; 
C_1 = 10 \pm 10\% \; \si{n\F}$.  

Affinché il passa basso non venga perturbato dal carico a valle
$R\ped{L} = \SI{100}{\kilo\ohm}$, l'impedenza in uscita dal circuito
$Z\ped{out}(\omega)$ dev'essere trascurabile rispetto a quella del carico.
\[
\abs{Z\ped{out}} = \abs{\left(\frac{1}{R_{1}} + j\omega 
C_{1}\right)^{-1}} \ll R\ped{L} \implies R_{1} \ll
R\ped{L} \sqrt{1 + \omega^{2} R_{1}^{2} C_{1}^{2}} =
R\ped{L} \sqrt{1 + \left(\frac{f}{f_1}\right)^{2}}.
\]
Dunque dobbiamo avere
\[
R_{1} \ll \SI{100}{\kilo\ohm}  \ \sqrt{1 + 
\left(\frac{f_l}{f_1}\right)^2} \approx \SI{112}{\kilo\ohm}.
\]
Abbiamo quindi scelto $R\ped{1 teo} = \SI{2}{\kilo\ohm}$.
Per cui prendiamo $C\ped{1 teo} =
\ds \frac{1}{2\pi R\ped{1 teo} f\ped{1 teo}} \approx \SI{8}{\nano\farad}$. 
\subsection*{1.e Misura di $C_1$}
\[
C_1 = 10.9 \pm 0.4 \si{n\F}
\]
Compatibile entro la tolleranza con il valore nominale.

\subsection*{1.f Calcolo della frequenza di taglio e delle attenuazioni attese}
\[
\begin{array}{rcl}
f_1 &=& 7.3 \pm 0.3\\
|A_v(3\,\mathrm{kHz})| &=& 0.93 \pm 0.04 \\
|A_v(30\,\mathrm{kHz})| &=& 0.24 \pm 0.01
\end{array}
\]

\subsection*{3 Misura $A_v$}
Dalla misura delle ampiezze dei segnali di ingresso/uscita e del loro 
sfasamento si ottiene:
\begin{table}[h]
\centering
\begin{tabular}{|c|c|c|c|c|}
\hline 
$f \pm \sigma(f)$ [kHz] & $V\ped{in} \pm \sigma(V\ped{in})$ [V] 
                        & $V\ped{out} \pm \sigma(V\ped{out})$ [V] & $A_v \pm \sigma(A_v)$
& $\phi \pm \sigma(\phi)$ \\
\hline 
$3.00 \pm 0.06$ & $1 \pm 0.05$ & $0.93 \pm 0.05$ & $0.93 \pm 0.07$ & $0.38 \pm 0.01$ \\
$7.34 \pm 0.15$ & $1 \pm 0.05$ & $0.72 \pm 0.04$ & $0.72 \pm 0.06$ & $1.32 \pm 0.04$ \\
$30.0 \pm 0.6$ & $1 \pm 0.05$ & $0.25 \pm 0.01$ & $0.25 \pm 0.02$ & $0.77 \pm 0.02$ \\
\hline 
\end{tabular} 
\caption{(3) Amplficazione e sfasamento del filtro passa-basso a bassa ed alta 
frequenza ed alla frequenza nominale di taglio.
\label{tab:par1}}
\end{table}

\subsection*{4 Risposta in frequenza}
\begin{figure}[htbp]
\centering
\includegraphics[scale=0.35]{rc2k10nF_new}
\caption{Plot di Bode per il filtro passa-basso.}
\end{figure}

\subsection*{5.a Stima della frequenza di taglio (metodo a)}
La nostra stima della frequenza per cui $A_v$(dB) = -3 dB \`e
\[
f_{1A} = 7336 \pm 13 \; \si{k\Hz}
\]

\subsection*{5.b Misura della frequenza di taglio (metodo b)}
Dal fit a bassa frequenza ($f\ll f_1$) otteniamo
\[
A_1(\rm mdB) = -17.91 \pm 0.18 \;\;\; \chi^2 = 243 \;\;\; d.o.f. = 873
\]

Ad alta frequenza ($f \gg f_1$) la retta di best-fit al plot di Bode in 
ampiezza ha i seguenti parametri:
\[
\mathrm{intercetta} = 75.928 \pm 0.008 \;\;\;\mathrm{pendenza} = -19.6747 \pm 
0.0016 \;\;\;\mathrm{correlazione} 
= -0.997 \;\;\; \chi^2 = 1647 \;\;\; d.o.f. = 1746
\]
Dall'~intersezione delle due rette stimiamo per la frequenza di taglio il valore
\[
f_{1B} = 7246 \pm 8 \; \si{Hz}
\]

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.7]{corner}
\caption{Fit al plot di bode per trovare la frequenza di corner. In verde i
punti non utilizzati nel fit. \label{fig: corner}}
\end{figure}

\subsection*{5.c Misura della frequenza di taglio (metodo c)}
Dal fit complessivo del modulo della funzione di trasferimento
\begin{equation}\label{eq: lpfgain}
\abs{T(f)} = A(f) = \frac{1}{\sqrt{1 + \left(\frac{f}{f_1}\right)^2}}
\end{equation}
otteniamo per l'~amplificazione di centro-banda e per la frequenza di taglio i 
seguenti valori:
\[
A_1 (\mathrm{mdB}) = -19.1 \pm 0.3 \;\;\; f_{1B} = 7428.8 \pm 0.9 \si{\Hz}
\;\;\;\ \chi^2 = 1614 \;\;\; d.o.f.= 4997
\]

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.7]{lpfbodefit}
\caption{Fit complessivo al plot di bode con l'espressione per l'attenuazione
\eqref{eq: lpfgain}.\label{fig: corner}}
\end{figure}

\subsection*{5.d Confronto misure-predizione}
\vspace{0.5cm}
\framebox(400,30){Commentare l'~accordo tra le varie stime di $f_1$ ed il 
valore atteso.}

\subsection*{6 Risposta del filtro ad un gradino}
Il fronte del segnale di uscita ha un tempo di salita, misurato con i cursori, 
di 
\[
t_r = 47 \pm 2 \; \si{\micro\second}
\]
da cui 
\[
f_1 = \ln(9) R_1 C_1 \simeq \frac{2.2}{2\pi t_r} = 7.4 \pm 0.3 \; \si{k\Hz}
\]
\begin{figure}[htb]
\centering
\includegraphics[scale=0.35]{rc2k10nF_rise}
\caption{(6) Risposta del filtro passa-basso ad un gradino di tensione.}
\end{figure}

\subsection*{7.a Impedenze di ingresso/uscita}
(Qui \`e sufficiente scrivere le espressioni in termini della frequenza e dei 
componenti)
\[
Z\ped{in}(\omega) = R_1 + \frac{1}{j \omega C_1} =
R_1 \left( 1 - j \frac{1}{\omega R_1 C_1} \right) =
R_1 \left( 1 - j \frac{\omega_1}{\omega} \right)
\]
\[
Z\ped{out}(\omega) = \left(\frac{1}{R_{1}} + j\omega C_{1}\right)^{-1}
\]

\subsection*{7.b Effetti dovuti all'~accoppiamento con un carico}
(Qui \`e richiesto che valutiate l'~amplificazione di centro-banda e la 
frequenza di taglio nel 
caso in cui il carico sia rispettivamente 100 e 10 k$\Omega$)
\[
\begin{array}{rl}
R_L=100 \,k\Omega & \Rightarrow A_1 = \ldots\;\;\; f_1 = \ldots\\
R_L=10 \,k\Omega & \Rightarrow A_1 = \ldots\;\;\; f_1 = \ldots\\
\end{array}
\]

%=======================
\section*{Filtro passa-banda}

\subsection*{8.a Misura dei componenti}
\[ 
C_1 = \ldots\pm \ldots
\]

\subsection*{8.b Filtro passa-basso, stima della frequenza di taglio}
Dalla risposta in frequenza risulta
\[
A_1(dB) = \ldots \pm \ldots,\;\;f_1 = \ldots\pm \ldots
\]

\subsection*{9.a Misura dei componenti}
\[ 
C_2 = 95 \pm 4 \; \si{n\F} \\
R_2 = 1.990 \pm 0.016 \; \si{k\ohm}
\]

\subsection*{9.b Filtro passa-alto, stima della frequenza di taglio}
Dalla risposta in frequenza risulta
\[
A_2(dB) = \ldots \pm \ldots,\;\;f_2 = \ldots\pm \ldots
\]

\subsection*{10.a Filtro passa-banda, risposta in frequenza}
\begin{figure}[h]
\centering
%\includegraphics[scale=0.4]{bpfnetwork}
\framebox(400,50){ (10.a) Salvare ed inserire l'~immagine del Network analyzer 
per il passa-banda}
\caption{(4) Plot di Bode per il filtro passa-banda.}
\end{figure}
La nostra stima dell'~amplificazione di centro-banda e delle frequenze di 
taglio (per cui il guadagno si riduce di 3 dB rispetto a centro-banda) \`e
\[
A(dB) = \ldots\pm \ldots \;\;\;f_{L} = \ldots\pm \ldots\;\;\;f_{H} = \ldots\pm 
\ldots
\]

\subsection*{10.b Interpolazione del plot di Bode}
Dal fit del plot di Bode in ampiezza si ha
\[
A(dB) = \ldots\pm \ldots \;\;\;f_{L} = \ldots\pm \ldots\;\;\;f_{H} = \ldots\pm 
\ldots\;\;\;\chi^2 = \ldots\;\;\; d.o.f.= \ldots
\]
\subsection*{10.c Differenze}
\vspace{0.5cm}
\framebox(400,30){Motivare la differenza rispetto ai filtri standalone}

\subsection*{10.d Dipendenza dai valori delle resistenze}
\vspace{0.5cm}
\framebox(400,30){Commentare la dipendenza dalle resistenze, come da guida}

\subsection*{10.e Andamento della fase}
\vspace{0.5cm}
\framebox(400,30){Commentare la dipendenza della fase dalla frequenza}

\section*{Conclusioni e commenti finali}
\framebox(400,30){Inserire eventuali commenti e conclusioni finali}

\section*{Dichiarazione}
I firmatari di questa relazione dichiarano che il contenuto della relazione \`e 
originale, con misure effettuate dai membri del gruppo, e che tutti i firmatari 
hanno contribuito alla elaborazione della relazione stessa.

\end{document}
