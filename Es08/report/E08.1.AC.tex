\documentclass[10pt, a4paper, italian]{article}
\input{../../latex/preamble}
\input{../../latex/math}
\geometry{left=2cm, right=2cm, top=2cm, bottom=2cm}

% indexes subsections with letters, sections with numbers (1.a, 1.b, ...)
\renewcommand{\thesubsection}{\thesection.\alph{subsection}}

% lets graphicx know path where figures to be included are found
\graphicspath{{../figs/}}

\author{Gruppo 1.AC \\ Matteo Rossi, Bernardo Tomelleri}
\title{Es08A: Amplificatore di tensione con JFET a emettitore comune}
\begin{document}
\date{\today}
\maketitle

\setcounter{section}{0}

\section{Misura componenti dei circuiti}
\begin{table}[htbp]
\centering
\begin{tabular}{cccccc}
\toprule
Resistenze $[\si{\ohm}]$ & $R$ & $\sigma R$ & Capacità $[\si{\F}]$ & $C$ &
$\sigma C$ \\
\midrule
\midrule
$R_1$	  & 100 	& 1 	 & $C\ped{in}$ & 95	n	 & 4 n \\
$R_S$	  & 219	& 3 	 & $C\ped{out}$ & 9.6 n	 & 0.4 n \\
$R_D$	  & 997		& 8	 	 & $C_S$ 		& 95  µ  & 5 µ \\
$R_G$	  & 1.02 M	& 0.1 M	 & & & \\
$R_s$	  & 99.6 k	& 0.8 k	 & & & \\
\bottomrule     
\end{tabular}
\caption{Valori di resistenza e capacità misurate per i componenti dei
circuiti studiati. \label{tab: rcmes_M}}
\end{table}

\begin{table}[htbp]
\centering
\begin{tabular}{cccccc}
\toprule
Resistenze $[\si{\ohm}]$ & $R$ & $\sigma R$ & Capacità $[\si{\F}]$ & $C$ &
$\sigma C$ \\
\midrule
\midrule
$R_1$	  & 100.2 	& 0.9 	 & $C\ped{in}$ & 99	n	 & 4 n \\
$R_s$	  & 217	& 3 	 & $C\ped{out}$ & 10.4 n	 & 0.4 n \\
$R_d$	  & 993		& 8	 	 & $C_S$ 		& 96  µ  & 4 µ \\
$R_g$	  & 994 k	& 8	 & & & \\
$R_s$	  & 996 k	& 8	 & & & \\
\bottomrule     
\end{tabular}
\caption{Valori di resistenza e capacità misurate per i componenti dei
circuiti studiati. \label{tab: rcmes_B}}
\end{table}

Riportiamo per completezza anche i valori delle tensioni di alimentazione
continue per gli op-amp misurate con il multimetro
\begin{align*}
V_{DD} &= 4.99 \pm 0.03 \si{\V} \\
V_{SS} &= -4.99 \pm 0.03 \si{\V}
\end{align*}

\subsection*{Nota sul metodo di fit}
Per determinare i parametri ottimali e le rispettive covarianze si \`e
implementato in \verb+Python+ un algoritmo di fit basato sui minimi quadrati
mediante la funzione \emph{curve\_fit} della libreria \texttt{SciPy}.

%=======================
\section{Studio del funzionamento}
Come primo passo abbiamo verificato il corretto funzionamento del JFET a canale
N 2N3819 studiandone le caratteristiche dalla configurazione circuitale
riportata in \ref{schm: tracer}
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.5]{Draft1}
    \caption{Schema circuitale per la verifica di funzionamento del JFET
    \label{schm: tracer}}
\end{figure}

Dal nostro modello sulla struttura del JFET sappiamo che all'aumentare di
$V_{GS}$ (in negativo verso $V_{SS} = \SI{-5}{\V})$ le zone della giunzione
vengono svuotate dai portatori di carica, fino a che non si raggiunge una
tensione di pinch-off $V_p$. Per valori di tensione $V_{GS} < V_P$ il canale
risulta completamente svuotato e la corrente di drain $I_{DS}$ tende a 0.
Al contrario, quando $V_{GS} = \SI{0}{\V}$ il canale risulta ``aperto'', quindi
ci aspettiamo di trovare in questa situazione la massima intensità di corrente
che può scorrere attraverso il transistor.

\subsection{Curve tracer}
Abbiamo applicato al gate una tensione di polarizzazione continua
$V_{SS}$ di -5 V in modo da polarizzare inversamente la giunzione
$\text{np}^+$ (gate-canale).
Dunque si invia in WG1 una rampa a scalini equispaziati di 250 mV partendo
da -5 V fino a 0 V, mentre in WG2 per ogni gradino step di WG1 si genera una
rampa che parte dal valore corrente di WG1 e arriva fino a 5 V.
Di seguito quello che otteniamo dall'oscilloscopio:
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.4]{time}
    \caption{Acquisizione all'oscilloscopio dell'andamento temporale dei
    segnali $V_{DS}$ (CH1), $V_{R_1}$ (CH2) e $I_{DS} = V_{R_1}/R_1$ (Math1)
    in funzione del tempo}
\end{figure}
Notiamo esplicitamente come $V_{DS}$ risulta sempre positivo, mentre $V_{GS}$
è sempre negativo, in accordo con le condizioni $V_{DS} > 0$ e $V_{GS} < 0$
da verificare.

\subsection{Curve caratteristiche ottenute}
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.4]{vgs}
    \caption{Curve caratteristiche del JFET $I_{DS}$ in funzione di $V_{DS}$
    al variare di $V_{GS}$ tra $-5$ e $\SI{0}{\V}$
    \label{fig: IDS-VDS}}
\end{figure}

\subsection{Confronto con datasheet}
Come detto prima, il momento in cui la corrente è maggiore (nel grafico a sinistra è sufficiente soffermarsi a vedere l'andamento di CH2) si ottiene quando $V_{GS}$ è pari a 0, che nello stesso grafico è quando la rampa di WG2 misurata da CH1 è più alta (perchè in quel caso $V_S$ è pari a $V_G$ ovvero $V_{SS}$.
Inoltre si può vedere che oltre un certo punto l'andamento di CH2 risulta approssimativamente costante: questo si ottiene quando viene superata la tensione di pinch-off, che siamo andati a misurare tramite cursori:
\[
V_p = -4.0 \pm 0.2 \; \si{\V}
\]
in cui l'incertezza associata sarà uguale al passo dei nostri scalini.
Infine, sempre utilizzando i cursori, abbiamo misurato la corrente nella traccia in cui $V_{GS} = 0$, nel grafico di sinistra è la curva più alta; da cui abbiamo ricavato:
\[
I_{DSS} = 12.6 \pm 0.2 \; \si{m\A}
\]
Confrontando col datasheet risulta che entrambi i valori risultano compatibili con gli intervalli dichiarati dai costruttori (dato che noi abbiamo utilizzato valori di $V_{DS}$ minori di quelli utilizzati nel datasheet)

%=======================
\section{Amplificatore e punto di lavoro}
A questo punto abbiamo costruito il circuito per l'amplificatore di tensione:
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.7]{Draft2}
    \caption{Schema circuitale per l'amplificazione di segnale tramite JFET}
\end{figure}
Quindi si è collegato $V_{CC}$ a 5V e $V_{SS}$ a -5V tenendo scollegato $V\ped{in}$ per verificare il punto di lavoro del JFET.

\subsection{Corrente di quiescenza}
Misurando la caduta di potenziale ai capi della resistenza $R_D$ abbiamo calcolato la corrente di quiescenza con la legge di ohm, da cui si ricava
\[
I_{DS}^Q = 6.27 \pm 0.06 \; \si{m\A}
\]
che risulta essere compatibile con la metà della $I_{DSS}$.
Si è quindi proseguito con la misura di $V_{GS}$ e di $V_{DS}$ per verificare quello che abbiamo appena misurato.
Sappiamo infatti che dato $V_{GS}$ e $V_p$ e se il JFET è in regime di saturazione:
\begin{equation}
I_{DS}=\frac{I_{DSS}}{V_p ^2}(V_{GS}-V_p)^2
\end{equation}

\subsection{Tensioni ai terminali del JFET}
Per misurare $V_{GS}$ si è calcolata la differenza tra le misure di $V_G$ e $V_S$:
\[
V_{GS}=-886 \pm 7 \; \si{m\V}
\]
\[
V_{DS}=2.35 \pm 0.01 \; \si{\V}
\]
Dato che $V_{DS} > V_{GS} - V_p$ si ricava che siamo in zona di saturazione, a questo punto basta applicare l'equazione; si ottiene quindi 
\[
I_{DS}(V_{GS},V_p,I_{DSS})=4.14 \pm 0.07 \; \si{m\A}
\]
Che risulta essere compatibile con quanto misurato.

\subsection{Stima della transconduttanza $g_m$}
Stimiamo infine la transconduttanza tramite la formula
\begin{equation}
g_m = \frac{2 I_{DSS}}{|V_p|}\sqrt{\frac{I_{d}}{I_{DSS}}}
\end{equation}
da cui ricaviamo $g_m = 4.73 \si{m\mho}$, andando quindi a ricercare nel datasheet il valore fornito da costruttore, troviamo un grafico di $g_m$ in funzione della frequenza a cui opera il JFET, in particolare notiamo che per frequenze minori di circa 500 Mhz la transconduttanza deve essere compresa approssimativamente tra 4 e 5, similarmente anche la transammettenza deve essere compresa tra 3 e 6.5 $\si{m\mho}$; il valore misurato risulta quindi compatibile.

%=======================
\section{Amplificazione di piccoli segnali a frequenza fissa}
A questo punto si è collegato l'ingresso $V\ped{in}$ all'entrata dell'amplificatore, e lo abbiamo pilotato con un'onda sinusoidale di 1 kHz con un'ampiezza compresa tra 100 mV e 2.8 V a passi di 100 mV. Dall'ampiezza (e la fase) della risposta in uscita $V\ped{out}$ abbiamo misurato il guadagno $A_v = \frac{V\ped{in}}{V\ped{out}}$

\begin{table}[htbp]
\centering
\begin{tabular}{cccccc}
\toprule
$V\ped{in} [V]$ & $\sigma V\ped{in}[V]$ & $V\ped{out} [V]$ & $\sigma V\ped{out} [V]$ & $|A_v|$ & $\sigma A_v$ \\
\midrule
\midrule
100 m & 1 m  & 206 m & 2 m   & 2.06 & 0.02 \\
200 m & 2 m  & 411 m & 4 m   & 2.05 & 0.02 \\
300 m & 3 m  & 616 m & 7 m  & 2.05 & 0.03 \\
400 m & 4 m  & 821 m & 7 m  & 2.05 & 0.02 \\
501 m & 4 m  & 1.03  & 8 m  & 2.05 & 0.02 \\
601 m & 7 m  & 1.22  & 18 m & 2.04 & 0.04 \\
701 m & 7 m  & 1.42  & 19 m & 2.03 & 0.03 \\
801 m & 7 m  & 1.62  & 20 m & 2.02 & 0.03 \\
901 m & 7 m  & 1.80  & 0.02 & 2.00 & 0.03 \\
1.00  & 8 m  & 1.99  & 0.02 & 1.99 & 0.03 \\
1.10  & 8 m  & 2.16  & 0.02 & 1.96 & 0.02 \\
1.20  & 8 m  & 2.31  & 0.02 & 1.93 & 0.02 \\
1.30  & 9 m  & 2.46  & 0.02 & 1.89 & 0.02 \\
1.40  & 9 m  & 2.59  & 0.03 & 1.86 & 0.02 \\
1.50  & 0.02 & 2.71  & 0.04 & 1.82 & 0.03 \\
1.60  & 0.02 & 2.84  & 0.04 & 1.78 & 0.03 \\
1.70  & 0.02 & 2.93  & 0.04 & 1.72 & 0.03 \\
1.80  & 0.02 & 3.05  & 0.04 & 1.69 & 0.03 \\
1.90  & 0.02 & 3.15  & 0.04 & 1.65 & 0.03 \\
2.00  & 0.02 & 3.25  & 0.04 & 1.62 & 0.03 \\
2.10  & 0.02 & 3.34  & 0.04 & 1.59 & 0.02 \\
2.20  & 0.02 & 3.48  & 0.04 & 1.56 & 0.02 \\
2.30  & 0.02 & 3.53  & 0.04 & 1.53 & 0.02 \\
2.40  & 0.02 & 3.59  & 0.04 & 1.49 & 0.02 \\
2.50  & 0.02 & 3.61  & 0.04 & 1.44 & 0.02 \\
2.60  & 0.03 & 3.63  & 0.04 & 1.39 & 0.02 \\
2.71  & 0.03 & 3.63  & 0.04 & 1.34 & 0.02 \\
2.81  & 0.04 & 3.64  & 0.04 & 1.29 & 0.02 \\
\bottomrule
\end{tabular}
\end{table}
Data la caratteristica del circuito di essere in configurazione common source, possiamo modellare il guadagno come
\begin{equation}
A_v = -\frac{g_m R_d}{1+g_mR_s}
\end{equation}
Utilizzando i dati ottenuti prima possiamo ricavare il valore atteso:
\[
A_v = -2.33 \pm 0.02
\]
Ci accorgiamo subito che questo risultato non risulta essere compatibile con quanto misurato prima.
Essendo il guadagno negativo se ne deduce che l'amplificatore sarà di tipo invertente, come ben visibile dai grafici di $V\ped{in}$ e $V\ped{out}$.
Se i due segnali sono in opposizione di fase il passaggio per 0 con la stessa
pendenza/slope devono distare un semi-periodo dall'altro; per cui ai massimi
del segnale in ingresso (la traccia gialla) corrispondono i minimi del segnale
in uscita (la traccia blu)

Da una misura con i cursori troviamo
\begin{align*}
\Delta t &= 50.2 \pm 1.0 \; \si{n\s} \\
\Delta \phi &= 2\pi f \Delta t = 3.14 \pm 0.06 \; \si{\radian}
\end{align*}

mentre con la funzione di misura automatica definita con uno script di Wavegen
risulta:
\[
\phi = 179.4 \pm 0.5 \; \si{\degree}
\]

che sono entrambi compatibili con il valore atteso di $\Delta \phi\ped{exp}
= \pi \; \si{\radian}$ per la natura invertente dell'amplificatore.
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.4]{amp.200}
    \caption{Grafici di $V\ped{in}$ e $V\ped{out}$ in funzione del tempo con ampiezza $V\ped{in}=200 \; \si{m\V}$}
\end{figure}
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.4]{amp.1000}
    \caption{Grafici di $V\ped{in}$ e $V\ped{out}$ in funzione del tempo con ampiezza $V\ped{in}=1 \; \si{\V}$; in questa situazione si nota una distorsione nel segnale in uscita, in particolare la parte inferiore dell'onda risulta schiacciata verso lo 0}
\end{figure}
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.4]{amp.2000}
    \caption{Grafici di $V\ped{in}$ e $V\ped{out}$ in funzione del tempo con ampiezza $V\ped{in}=2 \; \si{\V}$; qua la distorsione della parte inferiore dell'onda è molto più pronunciata}
\end{figure}
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.4]{amp.2500}
    \caption{Grafici di $V\ped{in}$ e $V\ped{out}$ in funzione del tempo con ampiezza $V\ped{in}=2.5 \; \si{\V}$; si inizia a intravedere un taglio nella parte superiore dell'onda, mentre la parte inferiore risulta ancora distorta}
\end{figure}
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.4]{amp.3000}
    \caption{Grafici di $V\ped{in}$ e $V\ped{out}$ in funzione del tempo con ampiezza $V\ped{in}= 3 \; \si{\V}$; il taglio della parte alta dell'onda risulta ora più evidente}
\end{figure}

%=======================
\section{Risposta in frequenza}
\subsection{Network Analyzer}
Si è inviato come segnale in ingresso all'amplificatore a emettitore comune una
sinusoide di frequenza compresa tra $\SI{5}{\Hz}$ e $\SI{10}{M\Hz}$ di
ampiezza costante pari a $V\ped{in} = 200 \; \si{m\V}$ e si è registrata la
risposta in frequenza del sistema monitorandone l'uscita in $V\ped{out}$ con
lo strumento Network dell'AD2
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.4]{network}
    \caption{Plot di Bode ottenuto dallo scan con Network tra $5 \; \si{\Hz}$ e
$\SI{10}{M\Hz}$ con un segnale sinusoidale in ingresso di ampiezza costante
$v\ped{in} = \SI{200}{m\V}$. \label{fig: bodeplot}}
\end{figure}

Si è quindi misurato con i cursori il guadagno di centro banda, che risulta essere pari a $6.31 \; \si{dB}$ che convertendolo in $A_v$ si ottiene $2.07$, che risulta compatibile con quanto misurato al punto precedente.
A partire da ciò abbiamo ricavato le frequenze di taglio (basso e alto) tramite cursori, ricercando quando la curva del guadagno vale 3.30 dB:
\begin{align*}
F_{TA} &= 3.54 \pm 0.02 \; \si{M\Hz} \\
F_{TB} &= 16.0 \pm 0.1 \; \si{\Hz}
\end{align*}

%=======================
\section{Aumento del guadagno}
Abbiamo ora inserito un condensatore elettrolitico in parallelo a $R_S$, chiamato $C_E$.
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.4]{amp.200.cap}
    \caption{Grafici di $V\ped{in}$ e $V\ped{out}$ in funzione del tempo con ampiezza $V\ped{in}=200 \; \si{m\V}$ con condensatore elettrolitico $C_E$ in parallelo a $R_s$}
\end{figure}
Aggiungendo il condensatore $C_E$ viene a modificarsi l'impedenza in parallelo con $R_s$, che diminuisce, aumentando così il guadagno secondo:
\begin{equation}
A_v = -\frac{g_m R_d}{1+g_m (R_{eq})}
\end{equation}
dove $R_{eq}$ è l'impedenza in parallelo tra $R_s$ e $C_E$ che vale:
\begin{equation}
R_{eq} = \frac{R_s}{j\omega C R_s +1}
\end{equation}
Utilizzando sempre la frequenza di 1 kHz ci si aspetta $A_v =$
Possiamo subito notare che il guadagno è aumentato come ci si aspettava ed è passato ad $A_v = 3.20 \pm 0.04$

%=======================
\section{Impedenza in ingresso}
Si è infine provata a misurare l'impedenza in ingresso al circuito mettendo in serie a $V\ped{in}$ un resistenza $R_S$ dello stesso ordine di grandezza dell'impedenza del circuito attesa, ed utilizzando lo strumento impedance analyzer di waveform in configurazione “W1-C1-R-C2-DUT-GND”; si è così valutata l'impedenza $Z_{IN}$ e la reattanza in parallelo $X_P$ in funzione della frequenza, compresa tra 1 e 10 kHz.
\begin{figure}[htbp]
    \centering
	\includegraphics[scale=0.4]{impedance}
    \caption{Grafici di impedenza in ingresso e reattanza parallelo in funzione della frequenza per $R_S=100 \si{k\ohm}$}
\end{figure}

%=======================
\section*{Conclusioni e commenti finali}
Si è riusciti a costruire e caratterizzare un amplificatore di tensione
invertente con un JFET in configurazione a emettitore comune. In particolare
si è riusciti ad apprezzare il differente comportamento (anche non lineare)
del circuito in vari regimi, dare una stima di guadagno, impedenza in
ingresso e frequenze caratteristiche della sua risposta in frequenza.

%=======================
\section*{Dichiarazione}
I firmatari di questa relazione dichiarano che il contenuto della relazione \`e
originale, con misure effettuate dai membri del gruppo, e che tutti i firmatari
hanno contribuito alla elaborazione della relazione stessa.

\end{document}
